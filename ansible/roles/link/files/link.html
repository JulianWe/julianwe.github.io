<!DOCTYPE html>
<html lang="en">

<head>
  <title>GitBlog</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon"
    href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' width='48' height='48' viewBox='0 0 16 16'><text x='0' y='14'>üêá</text></svg>" />
  <link rel="stylesheet" href="./css/blog.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
</head>

<body class="dark">
  <div class="main-container">
      <div class="aside">
        <div class="logo">
          <a href="ansible/roles/webpage/files/index.html#home"><span></span>GitBlog</a>
        </div>

        <div class="nav-toggler">
          <span></span>
        </div>

        <ul class="nav">
          <li><a href="index.html#home"><i class="fa fa-home"></i>Home</a></li>
          <li><a href="index.html#about"><i class="fa fa-user"></i>About</a></li>
          <li><a href="index.html#services"><i class="fa fa-list"></i>Services</a></li>
          <li><a href="index.html#blog" class="active"><i class="fa fa-briefcase"></i>Blog</a></li>
          <li><a href="https://github.com/JulianWe/julianwe.github.io"><i class="fa-brands fa-github"></i>GitHub</a></li>
          <li><a href="index.html#contact"><i class="fa fa-comments"></i>Contact</a></li>
        </ul>
      </div>
  </div>
</body>

  <section class="blogpost section " id="blogpost">
      <div class="container">

          <link rel="stylesheet" href="./css/markdown.css">
          <link rel="stylesheet" href="./css/md.css">
          
          <!-- Start README.md -->

          <h1 id="how-to-create-a-chainlink-operator-node">How to create a
Chainlink Operator Node</h1>
<p><img src="../../link/files/images/link.jpg" /></p>
<p><a href="https://docs.chain.link/">Docs</a></p>
<p><strong>Run Ethereum Client</strong></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> pull ethereum/client-go:latest</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> ~/.geth-goerli <span class="kw">&amp;&amp;</span> <span class="bu">cd</span> ~/.geth-goerli</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--name</span> eth <span class="at">-p</span> 8546:8546 <span class="at">-v</span> ~/.geth-goerli:/geth <span class="at">-it</span> <span class="dt">\</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    ethereum/client-go <span class="at">--goerli</span> <span class="at">--ws</span> <span class="at">--ipcdisable</span> <span class="dt">\</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">--ws.addr</span> 0.0.0.0 <span class="at">--ws.origins</span><span class="op">=</span><span class="st">&quot;*&quot;</span> <span class="at">--datadir</span> /geth</span></code></pre></div>
<p><strong>create alchemy or infura account</strong>
ETH_URL=wss://eth-goerli.alchemyapi.io/v2/YOUR_PROJECT_ID
ETH_URL=wss://goerli.infura.io/ws/v3/YOUR_PROJECT_ID</p>
<p>ETH_URL=wss://goerli.infura.io/v3/7611c5df22314fbe80f592e4ccce82b3
https://goerli.infura.io/v3/7611c5df22314fbe80f592e4ccce82b3</p>
<p><strong>create postgres database</strong></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">--name</span> cl-postgres <span class="at">-e</span> POSTGRES_PASSWORD=test0815test0815 <span class="at">-p</span> 5432:5432 <span class="at">-d</span> postgres</span></code></pre></div>
<p><strong>create toml config</strong></p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> ~/.chainlink-goerli <span class="kw">&amp;&amp;</span> <span class="bu">cd</span> ~/.chainlink-goerli</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;[Log]</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="st">Level = &#39;warn&#39;</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="st">[WebServer]</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="st">AllowOrigins = &#39;*&#39;</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="st">SecureCookies = false</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="st">[WebServer.TLS]</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="st">HTTPSPort = 0</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="st">[[EVM]]</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="st">ChainID = &#39;5&#39;</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="st">[[EVM.Nodes]]</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="st">Name = &#39;Goerli&#39;</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="st">WSURL = &#39;wss://goerli.infura.io/v3/7611c5df22314fbe80f592e4ccce82b3&#39;</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="st">HTTPURL = &#39;https://goerli.infura.io/v3/7611c5df22314fbe80f592e4ccce82b3&#39;</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span> <span class="op">&gt;</span> ~/.chainlink-goerli/config.toml</span></code></pre></div>
<p><strong>create database password config</strong></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">&quot;[Password]</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="st">Keystore = &#39;test0815test0815&#39;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="st">[Database]</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="st">URL = &#39;postgresql://postgres:test0815test0815@host.docker.internal:5432/postgres?sslmode=disable&#39;</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span> <span class="op">&gt;</span> ~/.chainlink-goerli/secrets.toml</span></code></pre></div>
<p><strong>run chainlink operator container</strong></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ~/.chainlink-goerli <span class="kw">&amp;&amp;</span> <span class="ex">docker</span> run <span class="at">--platform</span> linux/x86_64/v8 <span class="at">--name</span> chainlink <span class="at">-v</span> ~/.chainlink-goerli:/chainlink <span class="at">-it</span> <span class="at">-p</span> 6688:6688 <span class="at">--add-host</span><span class="op">=</span>host.docker.internal:host-gateway smartcontract/chainlink:2.0.0 node <span class="at">-config</span> /chainlink/config.toml <span class="at">-secrets</span> /chainlink/secrets.toml start</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Enter</span> API EMail:</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Enter</span> API Password:</span></code></pre></div>
<p><strong>Connect chainlink UI</strong> http://localhost:6688</p>
<p><img src="../../link/files/images/Operator.jpg" /></p>
<h1 id="how-to-setup-your-own-operator-smart-contract">How to setup your
own Operator Smart Contract</h1>
<p><a href="https://faucets.chain.link/goerli">Chainlink Testnet
Token</a> <a
href="https://docs.chain.link/chainlink-nodes/v1/fulfilling-requests">Chainlink
Docs Fulfilling Request</a></p>
<p><a
href="https://remix.ethereum.org/#url=https://docs.chain.link/samples/ChainlinkNodes/Operator.sol&amp;lang=en&amp;optimize=false&amp;runs=200&amp;evmVersion=null&amp;version=soljson-v0.7.6+commit.7338295f.js">Remix
Ethereum IDE</a></p>
<p><strong>In Remix IDE Select compiler version ‚Äò0.7.6‚Äô</strong></p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">// </span><span class="an">SPDX-License-Identifier:</span><span class="co"> MIT</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>pragma solidity <span class="op">^</span><span class="fl">0.7.6</span><span class="op">;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">&quot;@chainlink/contracts/src/v0</span><span class="op">.</span><span class="im">7/Operator</span><span class="op">.</span><span class="im">sol&quot;</span><span class="op">;</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>or</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co">// </span><span class="an">SPDX-License-Identifier:</span><span class="co"> MIT</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>pragma solidity <span class="op">^</span><span class="fl">0.7.6</span><span class="op">;</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">&quot;</span><span class="op">.</span><span class="im">/AuthorizedReceiver</span><span class="op">.</span><span class="im">sol&quot;</span><span class="op">;</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">&quot;</span><span class="op">.</span><span class="im">/LinkTokenReceiver</span><span class="op">.</span><span class="im">sol&quot;</span><span class="op">;</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">&quot;</span><span class="op">.</span><span class="im">/ConfirmedOwner</span><span class="op">.</span><span class="im">sol&quot;</span><span class="op">;</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">&quot;</span><span class="op">.</span><span class="im">/interfaces/LinkTokenInterface</span><span class="op">.</span><span class="im">sol&quot;</span><span class="op">;</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">&quot;</span><span class="op">.</span><span class="im">/interfaces/OperatorInterface</span><span class="op">.</span><span class="im">sol&quot;</span><span class="op">;</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">&quot;</span><span class="op">.</span><span class="im">/interfaces/OwnableInterface</span><span class="op">.</span><span class="im">sol&quot;</span><span class="op">;</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">&quot;</span><span class="op">.</span><span class="im">/interfaces/WithdrawalInterface</span><span class="op">.</span><span class="im">sol&quot;</span><span class="op">;</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">&quot;</span><span class="op">.</span><span class="im">/vendor/Address</span><span class="op">.</span><span class="im">sol&quot;</span><span class="op">;</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">&quot;</span><span class="op">.</span><span class="im">/vendor/SafeMathChainlink</span><span class="op">.</span><span class="im">sol&quot;</span><span class="op">;</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="co">@</span>title The Chainlink Operator contract</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> <span class="co">@</span>notice Node operators can deploy this contract to fulfill requests sent to them</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>contract Operator is AuthorizedReceiver<span class="op">,</span> ConfirmedOwner<span class="op">,</span> LinkTokenReceiver<span class="op">,</span> OperatorInterface<span class="op">,</span> WithdrawalInterface <span class="op">{</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>  using Address <span class="cf">for</span> address<span class="op">;</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>  using SafeMathChainlink <span class="cf">for</span> uint256<span class="op">;</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>  struct Commitment <span class="op">{</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>    bytes31 paramsHash<span class="op">;</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>    uint8 dataVersion<span class="op">;</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>  uint256 <span class="kw">public</span> constant getExpiryTime <span class="op">=</span> <span class="dv">5</span> minutes<span class="op">;</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>  uint256 <span class="kw">private</span> constant MAXIMUM_DATA_VERSION <span class="op">=</span> <span class="dv">256</span><span class="op">;</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>  uint256 <span class="kw">private</span> constant MINIMUM_CONSUMER_GAS_LIMIT <span class="op">=</span> <span class="dv">400000</span><span class="op">;</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>  uint256 <span class="kw">private</span> constant SELECTOR_LENGTH <span class="op">=</span> <span class="dv">4</span><span class="op">;</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>  uint256 <span class="kw">private</span> constant EXPECTED_REQUEST_WORDS <span class="op">=</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>  uint256 <span class="kw">private</span> constant MINIMUM_REQUEST_LENGTH <span class="op">=</span> SELECTOR_LENGTH <span class="op">+</span> <span class="op">(</span><span class="dv">32</span> <span class="op">*</span> EXPECTED_REQUEST_WORDS<span class="op">);</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>  <span class="co">// We initialize fields to 1 instead of 0 so that the first invocation</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>  <span class="co">// does not cost more gas.</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>  uint256 <span class="kw">private</span> constant ONE_FOR_CONSISTENT_GAS_COST <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>  <span class="co">// oracleRequest is intended for version 1, enabling single word responses</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>  bytes4 <span class="kw">private</span> constant ORACLE_REQUEST_SELECTOR <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">oracleRequest</span><span class="op">.</span><span class="fu">selector</span><span class="op">;</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>  <span class="co">// operatorRequest is intended for version 2, enabling multi-word responses</span></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>  bytes4 <span class="kw">private</span> constant OPERATOR_REQUEST_SELECTOR <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">operatorRequest</span><span class="op">.</span><span class="fu">selector</span><span class="op">;</span></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>  LinkTokenInterface internal immutable linkToken<span class="op">;</span></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mapping</span><span class="op">(</span>bytes32 <span class="op">=&gt;</span> Commitment<span class="op">)</span> <span class="kw">private</span> s_commitments<span class="op">;</span></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mapping</span><span class="op">(</span>address <span class="op">=&gt;</span> bool<span class="op">)</span> <span class="kw">private</span> s_owned<span class="op">;</span></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Tokens sent for requests that have not been fulfilled yet</span></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>  uint256 <span class="kw">private</span> s_tokensInEscrow <span class="op">=</span> ONE_FOR_CONSISTENT_GAS_COST<span class="op">;</span></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>  event <span class="fu">OracleRequest</span><span class="op">(</span></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>    bytes32 indexed specId<span class="op">,</span></span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>    address requester<span class="op">,</span></span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>    bytes32 requestId<span class="op">,</span></span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>    uint256 payment<span class="op">,</span></span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>    address callbackAddr<span class="op">,</span></span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>    bytes4 callbackFunctionId<span class="op">,</span></span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>    uint256 cancelExpiration<span class="op">,</span></span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>    uint256 dataVersion<span class="op">,</span></span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>    bytes data</span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>  <span class="op">);</span></span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>  event <span class="fu">CancelOracleRequest</span><span class="op">(</span>bytes32 indexed requestId<span class="op">);</span></span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a>  event <span class="fu">OracleResponse</span><span class="op">(</span>bytes32 indexed requestId<span class="op">);</span></span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>  event <span class="fu">OwnableContractAccepted</span><span class="op">(</span>address indexed acceptedContract<span class="op">);</span></span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a>  event <span class="fu">TargetsUpdatedAuthorizedSenders</span><span class="op">(</span>address<span class="op">[]</span> targets<span class="op">,</span> address<span class="op">[]</span> senders<span class="op">,</span> address changedBy<span class="op">);</span></span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a>  <span class="co">/**</span></span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="co">@</span>notice Deploy with the address of the LINK token</span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="co">@</span>dev Sets the LinkToken address for the imported LinkTokenInterface</span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a><span class="co">   * </span><span class="an">@param</span><span class="co"> </span><span class="an">link</span><span class="co"> </span>The address of the LINK token</span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">owner</span><span class="co"> </span>The address of the owner</span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a>   <span class="co">*/</span></span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">constructor</span><span class="op">(</span>address link<span class="op">,</span> address owner<span class="op">)</span> <span class="fu">ConfirmedOwner</span><span class="op">(</span>owner<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a>    linkToken <span class="op">=</span> <span class="fu">LinkTokenInterface</span><span class="op">(</span>link<span class="op">);</span> <span class="co">// external but already deployed and unalterable</span></span>
<span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-82"><a href="#cb6-82" aria-hidden="true" tabindex="-1"></a>  <span class="co">/**</span></span>
<span id="cb6-83"><a href="#cb6-83" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="co">@</span>notice The type and version of this contract</span>
<span id="cb6-84"><a href="#cb6-84" aria-hidden="true" tabindex="-1"></a><span class="co">   * </span><span class="an">@return</span> Type and version string</span>
<span id="cb6-85"><a href="#cb6-85" aria-hidden="true" tabindex="-1"></a>   <span class="co">*/</span></span>
<span id="cb6-86"><a href="#cb6-86" aria-hidden="true" tabindex="-1"></a>  function <span class="fu">typeAndVersion</span><span class="op">()</span> external pure virtual <span class="fu">returns</span> <span class="op">(</span>string memory<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-87"><a href="#cb6-87" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">&quot;Operator 1.0.0&quot;</span><span class="op">;</span></span>
<span id="cb6-88"><a href="#cb6-88" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb6-89"><a href="#cb6-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-90"><a href="#cb6-90" aria-hidden="true" tabindex="-1"></a>  <span class="co">/**</span></span>
<span id="cb6-91"><a href="#cb6-91" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="co">@</span>notice Creates the Chainlink request<span class="co">. </span>This is a backwards compatible API</span>
<span id="cb6-92"><a href="#cb6-92" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> with the Oracle<span class="co">.</span>sol contract<span class="co">,</span> but the behavior changes because</span>
<span id="cb6-93"><a href="#cb6-93" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> callbackAddress is assumed to be the same as the request sender<span class="co">.</span></span>
<span id="cb6-94"><a href="#cb6-94" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">callbackAddress</span><span class="co"> </span>The consumer of the request</span>
<span id="cb6-95"><a href="#cb6-95" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">payment</span><span class="co"> </span>The amount of payment given <span class="co">(</span>specified in wei<span class="co">)</span></span>
<span id="cb6-96"><a href="#cb6-96" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">specId</span><span class="co"> </span>The Job Specification ID</span>
<span id="cb6-97"><a href="#cb6-97" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">callbackAddress</span><span class="co"> </span>The address the oracle data will be sent to</span>
<span id="cb6-98"><a href="#cb6-98" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">callbackFunctionId</span><span class="co"> </span>The callback function ID for the response</span>
<span id="cb6-99"><a href="#cb6-99" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">nonce</span><span class="co"> </span>The nonce sent by the requester</span>
<span id="cb6-100"><a href="#cb6-100" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">dataVersion</span><span class="co"> </span>The specified data version</span>
<span id="cb6-101"><a href="#cb6-101" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">data</span><span class="co"> </span>The extra request parameters</span>
<span id="cb6-102"><a href="#cb6-102" aria-hidden="true" tabindex="-1"></a>   <span class="co">*/</span></span>
<span id="cb6-103"><a href="#cb6-103" aria-hidden="true" tabindex="-1"></a>  function <span class="fu">oracleRequest</span><span class="op">(</span></span>
<span id="cb6-104"><a href="#cb6-104" aria-hidden="true" tabindex="-1"></a>    address sender<span class="op">,</span></span>
<span id="cb6-105"><a href="#cb6-105" aria-hidden="true" tabindex="-1"></a>    uint256 payment<span class="op">,</span></span>
<span id="cb6-106"><a href="#cb6-106" aria-hidden="true" tabindex="-1"></a>    bytes32 specId<span class="op">,</span></span>
<span id="cb6-107"><a href="#cb6-107" aria-hidden="true" tabindex="-1"></a>    address callbackAddress<span class="op">,</span></span>
<span id="cb6-108"><a href="#cb6-108" aria-hidden="true" tabindex="-1"></a>    bytes4 callbackFunctionId<span class="op">,</span></span>
<span id="cb6-109"><a href="#cb6-109" aria-hidden="true" tabindex="-1"></a>    uint256 nonce<span class="op">,</span></span>
<span id="cb6-110"><a href="#cb6-110" aria-hidden="true" tabindex="-1"></a>    uint256 dataVersion<span class="op">,</span></span>
<span id="cb6-111"><a href="#cb6-111" aria-hidden="true" tabindex="-1"></a>    bytes calldata data</span>
<span id="cb6-112"><a href="#cb6-112" aria-hidden="true" tabindex="-1"></a>  <span class="op">)</span> external override validateFromLINK <span class="op">{</span></span>
<span id="cb6-113"><a href="#cb6-113" aria-hidden="true" tabindex="-1"></a>    <span class="op">(</span>bytes32 requestId<span class="op">,</span> uint256 expiration<span class="op">)</span> <span class="op">=</span> <span class="fu">_verifyAndProcessOracleRequest</span><span class="op">(</span></span>
<span id="cb6-114"><a href="#cb6-114" aria-hidden="true" tabindex="-1"></a>      sender<span class="op">,</span></span>
<span id="cb6-115"><a href="#cb6-115" aria-hidden="true" tabindex="-1"></a>      payment<span class="op">,</span></span>
<span id="cb6-116"><a href="#cb6-116" aria-hidden="true" tabindex="-1"></a>      callbackAddress<span class="op">,</span></span>
<span id="cb6-117"><a href="#cb6-117" aria-hidden="true" tabindex="-1"></a>      callbackFunctionId<span class="op">,</span></span>
<span id="cb6-118"><a href="#cb6-118" aria-hidden="true" tabindex="-1"></a>      nonce<span class="op">,</span></span>
<span id="cb6-119"><a href="#cb6-119" aria-hidden="true" tabindex="-1"></a>      dataVersion</span>
<span id="cb6-120"><a href="#cb6-120" aria-hidden="true" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb6-121"><a href="#cb6-121" aria-hidden="true" tabindex="-1"></a>    emit <span class="fu">OracleRequest</span><span class="op">(</span>specId<span class="op">,</span> sender<span class="op">,</span> requestId<span class="op">,</span> payment<span class="op">,</span> sender<span class="op">,</span> callbackFunctionId<span class="op">,</span> expiration<span class="op">,</span> dataVersion<span class="op">,</span> data<span class="op">);</span></span>
<span id="cb6-122"><a href="#cb6-122" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb6-123"><a href="#cb6-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-124"><a href="#cb6-124" aria-hidden="true" tabindex="-1"></a>  <span class="co">/**</span></span>
<span id="cb6-125"><a href="#cb6-125" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="co">@</span>notice Creates the Chainlink request</span>
<span id="cb6-126"><a href="#cb6-126" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="co">@</span>dev Stores the hash of the params as the on<span class="co">-</span>chain commitment for the request<span class="co">.</span></span>
<span id="cb6-127"><a href="#cb6-127" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> Emits OracleRequest event for the Chainlink node to detect<span class="co">.</span></span>
<span id="cb6-128"><a href="#cb6-128" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">sender</span><span class="co"> </span>The sender of the request</span>
<span id="cb6-129"><a href="#cb6-129" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">payment</span><span class="co"> </span>The amount of payment given <span class="co">(</span>specified in wei<span class="co">)</span></span>
<span id="cb6-130"><a href="#cb6-130" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">specId</span><span class="co"> </span>The Job Specification ID</span>
<span id="cb6-131"><a href="#cb6-131" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">callbackFunctionId</span><span class="co"> </span>The callback function ID for the response</span>
<span id="cb6-132"><a href="#cb6-132" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">nonce</span><span class="co"> </span>The nonce sent by the requester</span>
<span id="cb6-133"><a href="#cb6-133" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">dataVersion</span><span class="co"> </span>The specified data version</span>
<span id="cb6-134"><a href="#cb6-134" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">data</span><span class="co"> </span>The extra request parameters</span>
<span id="cb6-135"><a href="#cb6-135" aria-hidden="true" tabindex="-1"></a>   <span class="co">*/</span></span>
<span id="cb6-136"><a href="#cb6-136" aria-hidden="true" tabindex="-1"></a>  function <span class="fu">operatorRequest</span><span class="op">(</span></span>
<span id="cb6-137"><a href="#cb6-137" aria-hidden="true" tabindex="-1"></a>    address sender<span class="op">,</span></span>
<span id="cb6-138"><a href="#cb6-138" aria-hidden="true" tabindex="-1"></a>    uint256 payment<span class="op">,</span></span>
<span id="cb6-139"><a href="#cb6-139" aria-hidden="true" tabindex="-1"></a>    bytes32 specId<span class="op">,</span></span>
<span id="cb6-140"><a href="#cb6-140" aria-hidden="true" tabindex="-1"></a>    bytes4 callbackFunctionId<span class="op">,</span></span>
<span id="cb6-141"><a href="#cb6-141" aria-hidden="true" tabindex="-1"></a>    uint256 nonce<span class="op">,</span></span>
<span id="cb6-142"><a href="#cb6-142" aria-hidden="true" tabindex="-1"></a>    uint256 dataVersion<span class="op">,</span></span>
<span id="cb6-143"><a href="#cb6-143" aria-hidden="true" tabindex="-1"></a>    bytes calldata data</span>
<span id="cb6-144"><a href="#cb6-144" aria-hidden="true" tabindex="-1"></a>  <span class="op">)</span> external override validateFromLINK <span class="op">{</span></span>
<span id="cb6-145"><a href="#cb6-145" aria-hidden="true" tabindex="-1"></a>    <span class="op">(</span>bytes32 requestId<span class="op">,</span> uint256 expiration<span class="op">)</span> <span class="op">=</span> <span class="fu">_verifyAndProcessOracleRequest</span><span class="op">(</span></span>
<span id="cb6-146"><a href="#cb6-146" aria-hidden="true" tabindex="-1"></a>      sender<span class="op">,</span></span>
<span id="cb6-147"><a href="#cb6-147" aria-hidden="true" tabindex="-1"></a>      payment<span class="op">,</span></span>
<span id="cb6-148"><a href="#cb6-148" aria-hidden="true" tabindex="-1"></a>      sender<span class="op">,</span></span>
<span id="cb6-149"><a href="#cb6-149" aria-hidden="true" tabindex="-1"></a>      callbackFunctionId<span class="op">,</span></span>
<span id="cb6-150"><a href="#cb6-150" aria-hidden="true" tabindex="-1"></a>      nonce<span class="op">,</span></span>
<span id="cb6-151"><a href="#cb6-151" aria-hidden="true" tabindex="-1"></a>      dataVersion</span>
<span id="cb6-152"><a href="#cb6-152" aria-hidden="true" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb6-153"><a href="#cb6-153" aria-hidden="true" tabindex="-1"></a>    emit <span class="fu">OracleRequest</span><span class="op">(</span>specId<span class="op">,</span> sender<span class="op">,</span> requestId<span class="op">,</span> payment<span class="op">,</span> sender<span class="op">,</span> callbackFunctionId<span class="op">,</span> expiration<span class="op">,</span> dataVersion<span class="op">,</span> data<span class="op">);</span></span>
<span id="cb6-154"><a href="#cb6-154" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb6-155"><a href="#cb6-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-156"><a href="#cb6-156" aria-hidden="true" tabindex="-1"></a>  <span class="co">/**</span></span>
<span id="cb6-157"><a href="#cb6-157" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="co">@</span>notice Called by the Chainlink node to fulfill requests</span>
<span id="cb6-158"><a href="#cb6-158" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="co">@</span>dev Given params must hash back to the commitment stored from <span class="co">`</span>oracleRequest<span class="co">`.</span></span>
<span id="cb6-159"><a href="#cb6-159" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> Will call the callback address<span class="co">&#39;</span> callback function without bubbling up error</span>
<span id="cb6-160"><a href="#cb6-160" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> checking in a <span class="co">`</span>require<span class="co">`</span> so that the node can get paid<span class="co">.</span></span>
<span id="cb6-161"><a href="#cb6-161" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">requestId</span><span class="co"> </span>The fulfillment request ID that must match the requester<span class="co">&#39;</span>s</span>
<span id="cb6-162"><a href="#cb6-162" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">payment</span><span class="co"> </span>The payment amount that will be released for the oracle <span class="co">(</span>specified in wei<span class="co">)</span></span>
<span id="cb6-163"><a href="#cb6-163" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">callbackAddress</span><span class="co"> </span>The callback address to call for fulfillment</span>
<span id="cb6-164"><a href="#cb6-164" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">callbackFunctionId</span><span class="co"> </span>The callback function ID to use for fulfillment</span>
<span id="cb6-165"><a href="#cb6-165" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">expiration</span><span class="co"> </span>The expiration that the node should respond by before the requester can cancel</span>
<span id="cb6-166"><a href="#cb6-166" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">data</span><span class="co"> </span>The data to return to the consuming contract</span>
<span id="cb6-167"><a href="#cb6-167" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@return</span> Status if the external call was successful</span>
<span id="cb6-168"><a href="#cb6-168" aria-hidden="true" tabindex="-1"></a>   <span class="co">*/</span></span>
<span id="cb6-169"><a href="#cb6-169" aria-hidden="true" tabindex="-1"></a>  function <span class="fu">fulfillOracleRequest</span><span class="op">(</span></span>
<span id="cb6-170"><a href="#cb6-170" aria-hidden="true" tabindex="-1"></a>    bytes32 requestId<span class="op">,</span></span>
<span id="cb6-171"><a href="#cb6-171" aria-hidden="true" tabindex="-1"></a>    uint256 payment<span class="op">,</span></span>
<span id="cb6-172"><a href="#cb6-172" aria-hidden="true" tabindex="-1"></a>    address callbackAddress<span class="op">,</span></span>
<span id="cb6-173"><a href="#cb6-173" aria-hidden="true" tabindex="-1"></a>    bytes4 callbackFunctionId<span class="op">,</span></span>
<span id="cb6-174"><a href="#cb6-174" aria-hidden="true" tabindex="-1"></a>    uint256 expiration<span class="op">,</span></span>
<span id="cb6-175"><a href="#cb6-175" aria-hidden="true" tabindex="-1"></a>    bytes32 data</span>
<span id="cb6-176"><a href="#cb6-176" aria-hidden="true" tabindex="-1"></a>  <span class="op">)</span></span>
<span id="cb6-177"><a href="#cb6-177" aria-hidden="true" tabindex="-1"></a>    external</span>
<span id="cb6-178"><a href="#cb6-178" aria-hidden="true" tabindex="-1"></a>    override</span>
<span id="cb6-179"><a href="#cb6-179" aria-hidden="true" tabindex="-1"></a>    validateAuthorizedSender</span>
<span id="cb6-180"><a href="#cb6-180" aria-hidden="true" tabindex="-1"></a>    <span class="fu">validateRequestId</span><span class="op">(</span>requestId<span class="op">)</span></span>
<span id="cb6-181"><a href="#cb6-181" aria-hidden="true" tabindex="-1"></a>    <span class="fu">validateCallbackAddress</span><span class="op">(</span>callbackAddress<span class="op">)</span></span>
<span id="cb6-182"><a href="#cb6-182" aria-hidden="true" tabindex="-1"></a>    <span class="fu">returns</span> <span class="op">(</span>bool<span class="op">)</span></span>
<span id="cb6-183"><a href="#cb6-183" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb6-184"><a href="#cb6-184" aria-hidden="true" tabindex="-1"></a>    <span class="fu">_verifyOracleRequestAndProcessPayment</span><span class="op">(</span>requestId<span class="op">,</span> payment<span class="op">,</span> callbackAddress<span class="op">,</span> callbackFunctionId<span class="op">,</span> expiration<span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb6-185"><a href="#cb6-185" aria-hidden="true" tabindex="-1"></a>    emit <span class="fu">OracleResponse</span><span class="op">(</span>requestId<span class="op">);</span></span>
<span id="cb6-186"><a href="#cb6-186" aria-hidden="true" tabindex="-1"></a>    <span class="fu">require</span><span class="op">(</span><span class="fu">gasleft</span><span class="op">()</span> <span class="op">&gt;=</span> MINIMUM_CONSUMER_GAS_LIMIT<span class="op">,</span> <span class="st">&quot;Must provide consumer enough gas&quot;</span><span class="op">);</span></span>
<span id="cb6-187"><a href="#cb6-187" aria-hidden="true" tabindex="-1"></a>    <span class="co">// All updates to the oracle&#39;s fulfillment should come before calling the</span></span>
<span id="cb6-188"><a href="#cb6-188" aria-hidden="true" tabindex="-1"></a>    <span class="co">// callback(addr+functionId) as it is untrusted.</span></span>
<span id="cb6-189"><a href="#cb6-189" aria-hidden="true" tabindex="-1"></a>    <span class="co">// See: https://solidity.readthedocs.io/en/develop/security-considerations.html#use-the-checks-effects-interactions-pattern</span></span>
<span id="cb6-190"><a href="#cb6-190" aria-hidden="true" tabindex="-1"></a>    <span class="op">(</span>bool success<span class="op">,</span> <span class="op">)</span> <span class="op">=</span> callbackAddress<span class="op">.</span><span class="fu">call</span><span class="op">(</span>abi<span class="op">.</span><span class="fu">encodeWithSelector</span><span class="op">(</span>callbackFunctionId<span class="op">,</span> requestId<span class="op">,</span> data<span class="op">));</span> <span class="co">// solhint-disable-line avoid-low-level-calls</span></span>
<span id="cb6-191"><a href="#cb6-191" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> success<span class="op">;</span></span>
<span id="cb6-192"><a href="#cb6-192" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb6-193"><a href="#cb6-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-194"><a href="#cb6-194" aria-hidden="true" tabindex="-1"></a>  <span class="co">/**</span></span>
<span id="cb6-195"><a href="#cb6-195" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="co">@</span>notice Called by the Chainlink node to fulfill requests with multi<span class="co">-</span>word support</span>
<span id="cb6-196"><a href="#cb6-196" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="co">@</span>dev Given params must hash back to the commitment stored from <span class="co">`</span>oracleRequest<span class="co">`.</span></span>
<span id="cb6-197"><a href="#cb6-197" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> Will call the callback address<span class="co">&#39;</span> callback function without bubbling up error</span>
<span id="cb6-198"><a href="#cb6-198" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> checking in a <span class="co">`</span>require<span class="co">`</span> so that the node can get paid<span class="co">.</span></span>
<span id="cb6-199"><a href="#cb6-199" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">requestId</span><span class="co"> </span>The fulfillment request ID that must match the requester<span class="co">&#39;</span>s</span>
<span id="cb6-200"><a href="#cb6-200" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">payment</span><span class="co"> </span>The payment amount that will be released for the oracle <span class="co">(</span>specified in wei<span class="co">)</span></span>
<span id="cb6-201"><a href="#cb6-201" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">callbackAddress</span><span class="co"> </span>The callback address to call for fulfillment</span>
<span id="cb6-202"><a href="#cb6-202" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">callbackFunctionId</span><span class="co"> </span>The callback function ID to use for fulfillment</span>
<span id="cb6-203"><a href="#cb6-203" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">expiration</span><span class="co"> </span>The expiration that the node should respond by before the requester can cancel</span>
<span id="cb6-204"><a href="#cb6-204" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">data</span><span class="co"> </span>The data to return to the consuming contract</span>
<span id="cb6-205"><a href="#cb6-205" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@return</span> Status if the external call was successful</span>
<span id="cb6-206"><a href="#cb6-206" aria-hidden="true" tabindex="-1"></a>   <span class="co">*/</span></span>
<span id="cb6-207"><a href="#cb6-207" aria-hidden="true" tabindex="-1"></a>  function <span class="fu">fulfillOracleRequest2</span><span class="op">(</span></span>
<span id="cb6-208"><a href="#cb6-208" aria-hidden="true" tabindex="-1"></a>    bytes32 requestId<span class="op">,</span></span>
<span id="cb6-209"><a href="#cb6-209" aria-hidden="true" tabindex="-1"></a>    uint256 payment<span class="op">,</span></span>
<span id="cb6-210"><a href="#cb6-210" aria-hidden="true" tabindex="-1"></a>    address callbackAddress<span class="op">,</span></span>
<span id="cb6-211"><a href="#cb6-211" aria-hidden="true" tabindex="-1"></a>    bytes4 callbackFunctionId<span class="op">,</span></span>
<span id="cb6-212"><a href="#cb6-212" aria-hidden="true" tabindex="-1"></a>    uint256 expiration<span class="op">,</span></span>
<span id="cb6-213"><a href="#cb6-213" aria-hidden="true" tabindex="-1"></a>    bytes calldata data</span>
<span id="cb6-214"><a href="#cb6-214" aria-hidden="true" tabindex="-1"></a>  <span class="op">)</span></span>
<span id="cb6-215"><a href="#cb6-215" aria-hidden="true" tabindex="-1"></a>    external</span>
<span id="cb6-216"><a href="#cb6-216" aria-hidden="true" tabindex="-1"></a>    override</span>
<span id="cb6-217"><a href="#cb6-217" aria-hidden="true" tabindex="-1"></a>    validateAuthorizedSender</span>
<span id="cb6-218"><a href="#cb6-218" aria-hidden="true" tabindex="-1"></a>    <span class="fu">validateRequestId</span><span class="op">(</span>requestId<span class="op">)</span></span>
<span id="cb6-219"><a href="#cb6-219" aria-hidden="true" tabindex="-1"></a>    <span class="fu">validateCallbackAddress</span><span class="op">(</span>callbackAddress<span class="op">)</span></span>
<span id="cb6-220"><a href="#cb6-220" aria-hidden="true" tabindex="-1"></a>    <span class="fu">validateMultiWordResponseId</span><span class="op">(</span>requestId<span class="op">,</span> data<span class="op">)</span></span>
<span id="cb6-221"><a href="#cb6-221" aria-hidden="true" tabindex="-1"></a>    <span class="fu">returns</span> <span class="op">(</span>bool<span class="op">)</span></span>
<span id="cb6-222"><a href="#cb6-222" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb6-223"><a href="#cb6-223" aria-hidden="true" tabindex="-1"></a>    <span class="fu">_verifyOracleRequestAndProcessPayment</span><span class="op">(</span>requestId<span class="op">,</span> payment<span class="op">,</span> callbackAddress<span class="op">,</span> callbackFunctionId<span class="op">,</span> expiration<span class="op">,</span> <span class="dv">2</span><span class="op">);</span></span>
<span id="cb6-224"><a href="#cb6-224" aria-hidden="true" tabindex="-1"></a>    emit <span class="fu">OracleResponse</span><span class="op">(</span>requestId<span class="op">);</span></span>
<span id="cb6-225"><a href="#cb6-225" aria-hidden="true" tabindex="-1"></a>    <span class="fu">require</span><span class="op">(</span><span class="fu">gasleft</span><span class="op">()</span> <span class="op">&gt;=</span> MINIMUM_CONSUMER_GAS_LIMIT<span class="op">,</span> <span class="st">&quot;Must provide consumer enough gas&quot;</span><span class="op">);</span></span>
<span id="cb6-226"><a href="#cb6-226" aria-hidden="true" tabindex="-1"></a>    <span class="co">// All updates to the oracle&#39;s fulfillment should come before calling the</span></span>
<span id="cb6-227"><a href="#cb6-227" aria-hidden="true" tabindex="-1"></a>    <span class="co">// callback(addr+functionId) as it is untrusted.</span></span>
<span id="cb6-228"><a href="#cb6-228" aria-hidden="true" tabindex="-1"></a>    <span class="co">// See: https://solidity.readthedocs.io/en/develop/security-considerations.html#use-the-checks-effects-interactions-pattern</span></span>
<span id="cb6-229"><a href="#cb6-229" aria-hidden="true" tabindex="-1"></a>    <span class="op">(</span>bool success<span class="op">,</span> <span class="op">)</span> <span class="op">=</span> callbackAddress<span class="op">.</span><span class="fu">call</span><span class="op">(</span>abi<span class="op">.</span><span class="fu">encodePacked</span><span class="op">(</span>callbackFunctionId<span class="op">,</span> data<span class="op">));</span> <span class="co">// solhint-disable-line avoid-low-level-calls</span></span>
<span id="cb6-230"><a href="#cb6-230" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> success<span class="op">;</span></span>
<span id="cb6-231"><a href="#cb6-231" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb6-232"><a href="#cb6-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-233"><a href="#cb6-233" aria-hidden="true" tabindex="-1"></a>  <span class="co">/**</span></span>
<span id="cb6-234"><a href="#cb6-234" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="co">@</span>notice Transfer the ownership of ownable contracts<span class="co">. </span>This is primarily</span>
<span id="cb6-235"><a href="#cb6-235" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> intended for Authorized Forwarders but could possibly be extended to work</span>
<span id="cb6-236"><a href="#cb6-236" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> with future contracts<span class="co">.</span></span>
<span id="cb6-237"><a href="#cb6-237" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">ownable</span><span class="co"> </span>list of addresses to transfer</span>
<span id="cb6-238"><a href="#cb6-238" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">newOwner</span><span class="co"> </span>address to transfer ownership to</span>
<span id="cb6-239"><a href="#cb6-239" aria-hidden="true" tabindex="-1"></a>   <span class="co">*/</span></span>
<span id="cb6-240"><a href="#cb6-240" aria-hidden="true" tabindex="-1"></a>  function <span class="fu">transferOwnableContracts</span><span class="op">(</span>address<span class="op">[]</span> calldata ownable<span class="op">,</span> address newOwner<span class="op">)</span> external onlyOwner <span class="op">{</span></span>
<span id="cb6-241"><a href="#cb6-241" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>uint256 i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> ownable<span class="op">.</span><span class="fu">length</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb6-242"><a href="#cb6-242" aria-hidden="true" tabindex="-1"></a>      s_owned<span class="op">[</span>ownable<span class="op">[</span>i<span class="op">]]</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb6-243"><a href="#cb6-243" aria-hidden="true" tabindex="-1"></a>      <span class="fu">OwnableInterface</span><span class="op">(</span>ownable<span class="op">[</span>i<span class="op">]).</span><span class="fu">transferOwnership</span><span class="op">(</span>newOwner<span class="op">);</span></span>
<span id="cb6-244"><a href="#cb6-244" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb6-245"><a href="#cb6-245" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb6-246"><a href="#cb6-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-247"><a href="#cb6-247" aria-hidden="true" tabindex="-1"></a>  <span class="co">/**</span></span>
<span id="cb6-248"><a href="#cb6-248" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="co">@</span>notice Accept the ownership of an ownable contract<span class="co">. </span>This is primarily</span>
<span id="cb6-249"><a href="#cb6-249" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> intended for Authorized Forwarders but could possibly be extended to work</span>
<span id="cb6-250"><a href="#cb6-250" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> with future contracts<span class="co">.</span></span>
<span id="cb6-251"><a href="#cb6-251" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="co">@</span>dev Must be the pending owner on the contract</span>
<span id="cb6-252"><a href="#cb6-252" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">ownable</span><span class="co"> </span>list of addresses of Ownable contracts to accept</span>
<span id="cb6-253"><a href="#cb6-253" aria-hidden="true" tabindex="-1"></a>   <span class="co">*/</span></span>
<span id="cb6-254"><a href="#cb6-254" aria-hidden="true" tabindex="-1"></a>  function <span class="fu">acceptOwnableContracts</span><span class="op">(</span>address<span class="op">[]</span> calldata ownable<span class="op">)</span> <span class="kw">public</span> validateAuthorizedSenderSetter <span class="op">{</span></span>
<span id="cb6-255"><a href="#cb6-255" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>uint256 i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> ownable<span class="op">.</span><span class="fu">length</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb6-256"><a href="#cb6-256" aria-hidden="true" tabindex="-1"></a>      s_owned<span class="op">[</span>ownable<span class="op">[</span>i<span class="op">]]</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb6-257"><a href="#cb6-257" aria-hidden="true" tabindex="-1"></a>      emit <span class="fu">OwnableContractAccepted</span><span class="op">(</span>ownable<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb6-258"><a href="#cb6-258" aria-hidden="true" tabindex="-1"></a>      <span class="fu">OwnableInterface</span><span class="op">(</span>ownable<span class="op">[</span>i<span class="op">]).</span><span class="fu">acceptOwnership</span><span class="op">();</span></span>
<span id="cb6-259"><a href="#cb6-259" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb6-260"><a href="#cb6-260" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb6-261"><a href="#cb6-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-262"><a href="#cb6-262" aria-hidden="true" tabindex="-1"></a>  <span class="co">/**</span></span>
<span id="cb6-263"><a href="#cb6-263" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="co">@</span>notice Sets the fulfillment permission for</span>
<span id="cb6-264"><a href="#cb6-264" aria-hidden="true" tabindex="-1"></a><span class="co">   * </span><span class="an">@param</span><span class="co"> </span><span class="an">targets</span><span class="co"> </span>The addresses to set permissions on</span>
<span id="cb6-265"><a href="#cb6-265" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">senders</span><span class="co"> </span>The addresses that are allowed to send updates</span>
<span id="cb6-266"><a href="#cb6-266" aria-hidden="true" tabindex="-1"></a>   <span class="co">*/</span></span>
<span id="cb6-267"><a href="#cb6-267" aria-hidden="true" tabindex="-1"></a>  function <span class="fu">setAuthorizedSendersOn</span><span class="op">(</span>address<span class="op">[]</span> calldata targets<span class="op">,</span> address<span class="op">[]</span> calldata senders<span class="op">)</span></span>
<span id="cb6-268"><a href="#cb6-268" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span></span>
<span id="cb6-269"><a href="#cb6-269" aria-hidden="true" tabindex="-1"></a>    validateAuthorizedSenderSetter</span>
<span id="cb6-270"><a href="#cb6-270" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb6-271"><a href="#cb6-271" aria-hidden="true" tabindex="-1"></a>    <span class="fu">TargetsUpdatedAuthorizedSenders</span><span class="op">(</span>targets<span class="op">,</span> senders<span class="op">,</span> msg<span class="op">.</span><span class="fu">sender</span><span class="op">);</span></span>
<span id="cb6-272"><a href="#cb6-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-273"><a href="#cb6-273" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>uint256 i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> targets<span class="op">.</span><span class="fu">length</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb6-274"><a href="#cb6-274" aria-hidden="true" tabindex="-1"></a>      <span class="fu">AuthorizedReceiverInterface</span><span class="op">(</span>targets<span class="op">[</span>i<span class="op">]).</span><span class="fu">setAuthorizedSenders</span><span class="op">(</span>senders<span class="op">);</span></span>
<span id="cb6-275"><a href="#cb6-275" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb6-276"><a href="#cb6-276" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb6-277"><a href="#cb6-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-278"><a href="#cb6-278" aria-hidden="true" tabindex="-1"></a>  <span class="co">/**</span></span>
<span id="cb6-279"><a href="#cb6-279" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="co">@</span>notice Accepts ownership of ownable contracts and then immediately sets</span>
<span id="cb6-280"><a href="#cb6-280" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> the authorized sender list on each of the newly owned contracts<span class="co">. </span>This is</span>
<span id="cb6-281"><a href="#cb6-281" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> primarily intended for Authorized Forwarders but could possibly be</span>
<span id="cb6-282"><a href="#cb6-282" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> extended to work with future contracts<span class="co">.</span></span>
<span id="cb6-283"><a href="#cb6-283" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">targets</span><span class="co"> </span>The addresses to set permissions on</span>
<span id="cb6-284"><a href="#cb6-284" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">senders</span><span class="co"> </span>The addresses that are allowed to send updates</span>
<span id="cb6-285"><a href="#cb6-285" aria-hidden="true" tabindex="-1"></a>   <span class="co">*/</span></span>
<span id="cb6-286"><a href="#cb6-286" aria-hidden="true" tabindex="-1"></a>  function <span class="fu">acceptAuthorizedReceivers</span><span class="op">(</span>address<span class="op">[]</span> calldata targets<span class="op">,</span> address<span class="op">[]</span> calldata senders<span class="op">)</span></span>
<span id="cb6-287"><a href="#cb6-287" aria-hidden="true" tabindex="-1"></a>    external</span>
<span id="cb6-288"><a href="#cb6-288" aria-hidden="true" tabindex="-1"></a>    validateAuthorizedSenderSetter</span>
<span id="cb6-289"><a href="#cb6-289" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb6-290"><a href="#cb6-290" aria-hidden="true" tabindex="-1"></a>    <span class="fu">acceptOwnableContracts</span><span class="op">(</span>targets<span class="op">);</span></span>
<span id="cb6-291"><a href="#cb6-291" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setAuthorizedSendersOn</span><span class="op">(</span>targets<span class="op">,</span> senders<span class="op">);</span></span>
<span id="cb6-292"><a href="#cb6-292" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb6-293"><a href="#cb6-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-294"><a href="#cb6-294" aria-hidden="true" tabindex="-1"></a>  <span class="co">/**</span></span>
<span id="cb6-295"><a href="#cb6-295" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="co">@</span>notice Allows the node operator to withdraw earned LINK to a given address</span>
<span id="cb6-296"><a href="#cb6-296" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="co">@</span>dev The owner of the contract can be another wallet and does not have to be a Chainlink node</span>
<span id="cb6-297"><a href="#cb6-297" aria-hidden="true" tabindex="-1"></a><span class="co">   * </span><span class="an">@param</span><span class="co"> </span><span class="an">recipient</span><span class="co"> </span>The address to send the LINK token to</span>
<span id="cb6-298"><a href="#cb6-298" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">amount</span><span class="co"> </span>The amount to send <span class="co">(</span>specified in wei<span class="co">)</span></span>
<span id="cb6-299"><a href="#cb6-299" aria-hidden="true" tabindex="-1"></a>   <span class="co">*/</span></span>
<span id="cb6-300"><a href="#cb6-300" aria-hidden="true" tabindex="-1"></a>  function <span class="fu">withdraw</span><span class="op">(</span>address recipient<span class="op">,</span> uint256 amount<span class="op">)</span></span>
<span id="cb6-301"><a href="#cb6-301" aria-hidden="true" tabindex="-1"></a>    external</span>
<span id="cb6-302"><a href="#cb6-302" aria-hidden="true" tabindex="-1"></a>    <span class="fu">override</span><span class="op">(</span>OracleInterface<span class="op">,</span> WithdrawalInterface<span class="op">)</span></span>
<span id="cb6-303"><a href="#cb6-303" aria-hidden="true" tabindex="-1"></a>    onlyOwner</span>
<span id="cb6-304"><a href="#cb6-304" aria-hidden="true" tabindex="-1"></a>    <span class="fu">validateAvailableFunds</span><span class="op">(</span>amount<span class="op">)</span></span>
<span id="cb6-305"><a href="#cb6-305" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb6-306"><a href="#cb6-306" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span><span class="op">(</span>linkToken<span class="op">.</span><span class="fu">transfer</span><span class="op">(</span>recipient<span class="op">,</span> amount<span class="op">));</span></span>
<span id="cb6-307"><a href="#cb6-307" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb6-308"><a href="#cb6-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-309"><a href="#cb6-309" aria-hidden="true" tabindex="-1"></a>  <span class="co">/**</span></span>
<span id="cb6-310"><a href="#cb6-310" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="co">@</span>notice Displays the amount of LINK that is available for the node operator to withdraw</span>
<span id="cb6-311"><a href="#cb6-311" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="co">@</span>dev We use <span class="co">`</span>ONE_FOR_CONSISTENT_GAS_COST<span class="co">`</span> in place of <span class="co">0</span> in storage</span>
<span id="cb6-312"><a href="#cb6-312" aria-hidden="true" tabindex="-1"></a><span class="co">   * </span><span class="an">@return</span> The amount of withdrawable LINK on the contract</span>
<span id="cb6-313"><a href="#cb6-313" aria-hidden="true" tabindex="-1"></a>   <span class="co">*/</span></span>
<span id="cb6-314"><a href="#cb6-314" aria-hidden="true" tabindex="-1"></a>  function <span class="fu">withdrawable</span><span class="op">()</span> external view <span class="fu">override</span><span class="op">(</span>OracleInterface<span class="op">,</span> WithdrawalInterface<span class="op">)</span> <span class="fu">returns</span> <span class="op">(</span>uint256<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-315"><a href="#cb6-315" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">_fundsAvailable</span><span class="op">();</span></span>
<span id="cb6-316"><a href="#cb6-316" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb6-317"><a href="#cb6-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-318"><a href="#cb6-318" aria-hidden="true" tabindex="-1"></a>  <span class="co">/**</span></span>
<span id="cb6-319"><a href="#cb6-319" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="co">@</span>notice Forward a call to another contract</span>
<span id="cb6-320"><a href="#cb6-320" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="co">@</span>dev Only callable by the owner</span>
<span id="cb6-321"><a href="#cb6-321" aria-hidden="true" tabindex="-1"></a><span class="co">   * </span><span class="an">@param</span><span class="co"> </span><span class="an">to</span><span class="co"> </span>address</span>
<span id="cb6-322"><a href="#cb6-322" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">data</span><span class="co"> </span>to forward</span>
<span id="cb6-323"><a href="#cb6-323" aria-hidden="true" tabindex="-1"></a>   <span class="co">*/</span></span>
<span id="cb6-324"><a href="#cb6-324" aria-hidden="true" tabindex="-1"></a>  function <span class="fu">ownerForward</span><span class="op">(</span>address to<span class="op">,</span> bytes calldata data<span class="op">)</span> external onlyOwner <span class="fu">validateNotToLINK</span><span class="op">(</span>to<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-325"><a href="#cb6-325" aria-hidden="true" tabindex="-1"></a>    <span class="fu">require</span><span class="op">(</span>to<span class="op">.</span><span class="fu">isContract</span><span class="op">(),</span> <span class="st">&quot;Must forward to a contract&quot;</span><span class="op">);</span></span>
<span id="cb6-326"><a href="#cb6-326" aria-hidden="true" tabindex="-1"></a>    <span class="op">(</span>bool status<span class="op">,</span> <span class="op">)</span> <span class="op">=</span> to<span class="op">.</span><span class="fu">call</span><span class="op">(</span>data<span class="op">);</span></span>
<span id="cb6-327"><a href="#cb6-327" aria-hidden="true" tabindex="-1"></a>    <span class="fu">require</span><span class="op">(</span>status<span class="op">,</span> <span class="st">&quot;Forwarded call failed&quot;</span><span class="op">);</span></span>
<span id="cb6-328"><a href="#cb6-328" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb6-329"><a href="#cb6-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-330"><a href="#cb6-330" aria-hidden="true" tabindex="-1"></a>  <span class="co">/**</span></span>
<span id="cb6-331"><a href="#cb6-331" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="co">@</span>notice Interact with other LinkTokenReceiver contracts by calling transferAndCall</span>
<span id="cb6-332"><a href="#cb6-332" aria-hidden="true" tabindex="-1"></a><span class="co">   * </span><span class="an">@param</span><span class="co"> </span><span class="an">to</span><span class="co"> </span>The address to transfer to<span class="co">.</span></span>
<span id="cb6-333"><a href="#cb6-333" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">value</span><span class="co"> </span>The amount to be transferred<span class="co">.</span></span>
<span id="cb6-334"><a href="#cb6-334" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">data</span><span class="co"> </span>The extra data to be passed to the receiving contract<span class="co">.</span></span>
<span id="cb6-335"><a href="#cb6-335" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@return</span> success bool</span>
<span id="cb6-336"><a href="#cb6-336" aria-hidden="true" tabindex="-1"></a>   <span class="co">*/</span></span>
<span id="cb6-337"><a href="#cb6-337" aria-hidden="true" tabindex="-1"></a>  function <span class="fu">ownerTransferAndCall</span><span class="op">(</span></span>
<span id="cb6-338"><a href="#cb6-338" aria-hidden="true" tabindex="-1"></a>    address to<span class="op">,</span></span>
<span id="cb6-339"><a href="#cb6-339" aria-hidden="true" tabindex="-1"></a>    uint256 value<span class="op">,</span></span>
<span id="cb6-340"><a href="#cb6-340" aria-hidden="true" tabindex="-1"></a>    bytes calldata data</span>
<span id="cb6-341"><a href="#cb6-341" aria-hidden="true" tabindex="-1"></a>  <span class="op">)</span> external override onlyOwner <span class="fu">validateAvailableFunds</span><span class="op">(</span>value<span class="op">)</span> <span class="fu">returns</span> <span class="op">(</span>bool success<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-342"><a href="#cb6-342" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> linkToken<span class="op">.</span><span class="fu">transferAndCall</span><span class="op">(</span>to<span class="op">,</span> value<span class="op">,</span> data<span class="op">);</span></span>
<span id="cb6-343"><a href="#cb6-343" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb6-344"><a href="#cb6-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-345"><a href="#cb6-345" aria-hidden="true" tabindex="-1"></a>  <span class="co">/**</span></span>
<span id="cb6-346"><a href="#cb6-346" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="co">@</span>notice Distribute funds to multiple addresses using ETH send</span>
<span id="cb6-347"><a href="#cb6-347" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> to this payable function<span class="co">.</span></span>
<span id="cb6-348"><a href="#cb6-348" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="co">@</span>dev Array length must be equal<span class="co">,</span> ETH sent must equal the sum of amounts<span class="co">.</span></span>
<span id="cb6-349"><a href="#cb6-349" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> A malicious receiver could cause the distribution to revert<span class="co">,</span> in which case</span>
<span id="cb6-350"><a href="#cb6-350" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> it is expected that the address is removed from the list<span class="co">.</span></span>
<span id="cb6-351"><a href="#cb6-351" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">receivers</span><span class="co"> </span>list of addresses</span>
<span id="cb6-352"><a href="#cb6-352" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">amounts</span><span class="co"> </span>list of amounts</span>
<span id="cb6-353"><a href="#cb6-353" aria-hidden="true" tabindex="-1"></a>   <span class="co">*/</span></span>
<span id="cb6-354"><a href="#cb6-354" aria-hidden="true" tabindex="-1"></a>  function <span class="fu">distributeFunds</span><span class="op">(</span>address payable<span class="op">[]</span> calldata receivers<span class="op">,</span> uint256<span class="op">[]</span> calldata amounts<span class="op">)</span> external payable <span class="op">{</span></span>
<span id="cb6-355"><a href="#cb6-355" aria-hidden="true" tabindex="-1"></a>    <span class="fu">require</span><span class="op">(</span>receivers<span class="op">.</span><span class="fu">length</span> <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> receivers<span class="op">.</span><span class="fu">length</span> <span class="op">==</span> amounts<span class="op">.</span><span class="fu">length</span><span class="op">,</span> <span class="st">&quot;Invalid array length(s)&quot;</span><span class="op">);</span></span>
<span id="cb6-356"><a href="#cb6-356" aria-hidden="true" tabindex="-1"></a>    uint256 valueRemaining <span class="op">=</span> msg<span class="op">.</span><span class="fu">value</span><span class="op">;</span></span>
<span id="cb6-357"><a href="#cb6-357" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>uint256 i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> receivers<span class="op">.</span><span class="fu">length</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb6-358"><a href="#cb6-358" aria-hidden="true" tabindex="-1"></a>      uint256 sendAmount <span class="op">=</span> amounts<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb6-359"><a href="#cb6-359" aria-hidden="true" tabindex="-1"></a>      valueRemaining <span class="op">=</span> valueRemaining<span class="op">.</span><span class="fu">sub</span><span class="op">(</span>sendAmount<span class="op">);</span></span>
<span id="cb6-360"><a href="#cb6-360" aria-hidden="true" tabindex="-1"></a>      receivers<span class="op">[</span>i<span class="op">].</span><span class="fu">transfer</span><span class="op">(</span>sendAmount<span class="op">);</span></span>
<span id="cb6-361"><a href="#cb6-361" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb6-362"><a href="#cb6-362" aria-hidden="true" tabindex="-1"></a>    <span class="fu">require</span><span class="op">(</span>valueRemaining <span class="op">==</span> <span class="dv">0</span><span class="op">,</span> <span class="st">&quot;Too much ETH sent&quot;</span><span class="op">);</span></span>
<span id="cb6-363"><a href="#cb6-363" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb6-364"><a href="#cb6-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-365"><a href="#cb6-365" aria-hidden="true" tabindex="-1"></a>  <span class="co">/**</span></span>
<span id="cb6-366"><a href="#cb6-366" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="co">@</span>notice Allows recipient to cancel requests sent to this oracle contract<span class="co">.</span></span>
<span id="cb6-367"><a href="#cb6-367" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> Will transfer the LINK sent for the request back to the recipient address<span class="co">.</span></span>
<span id="cb6-368"><a href="#cb6-368" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="co">@</span>dev Given params must hash to a commitment stored on the contract in order</span>
<span id="cb6-369"><a href="#cb6-369" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> for the request to be valid<span class="co">.</span> Emits CancelOracleRequest event<span class="co">.</span></span>
<span id="cb6-370"><a href="#cb6-370" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">requestId</span><span class="co"> </span>The request ID</span>
<span id="cb6-371"><a href="#cb6-371" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">payment</span><span class="co"> </span>The amount of payment given <span class="co">(</span>specified in wei<span class="co">)</span></span>
<span id="cb6-372"><a href="#cb6-372" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">callbackFunc</span><span class="co"> </span>The requester<span class="co">&#39;</span>s specified callback function selector</span>
<span id="cb6-373"><a href="#cb6-373" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">expiration</span><span class="co"> </span>The time of the expiration for the request</span>
<span id="cb6-374"><a href="#cb6-374" aria-hidden="true" tabindex="-1"></a>   <span class="co">*/</span></span>
<span id="cb6-375"><a href="#cb6-375" aria-hidden="true" tabindex="-1"></a>  function <span class="fu">cancelOracleRequest</span><span class="op">(</span></span>
<span id="cb6-376"><a href="#cb6-376" aria-hidden="true" tabindex="-1"></a>    bytes32 requestId<span class="op">,</span></span>
<span id="cb6-377"><a href="#cb6-377" aria-hidden="true" tabindex="-1"></a>    uint256 payment<span class="op">,</span></span>
<span id="cb6-378"><a href="#cb6-378" aria-hidden="true" tabindex="-1"></a>    bytes4 callbackFunc<span class="op">,</span></span>
<span id="cb6-379"><a href="#cb6-379" aria-hidden="true" tabindex="-1"></a>    uint256 expiration</span>
<span id="cb6-380"><a href="#cb6-380" aria-hidden="true" tabindex="-1"></a>  <span class="op">)</span> external override <span class="op">{</span></span>
<span id="cb6-381"><a href="#cb6-381" aria-hidden="true" tabindex="-1"></a>    bytes31 paramsHash <span class="op">=</span> <span class="fu">_buildParamsHash</span><span class="op">(</span>payment<span class="op">,</span> msg<span class="op">.</span><span class="fu">sender</span><span class="op">,</span> callbackFunc<span class="op">,</span> expiration<span class="op">);</span></span>
<span id="cb6-382"><a href="#cb6-382" aria-hidden="true" tabindex="-1"></a>    <span class="fu">require</span><span class="op">(</span>s_commitments<span class="op">[</span>requestId<span class="op">].</span><span class="fu">paramsHash</span> <span class="op">==</span> paramsHash<span class="op">,</span> <span class="st">&quot;Params do not match request ID&quot;</span><span class="op">);</span></span>
<span id="cb6-383"><a href="#cb6-383" aria-hidden="true" tabindex="-1"></a>    <span class="co">// solhint-disable-next-line not-rely-on-time</span></span>
<span id="cb6-384"><a href="#cb6-384" aria-hidden="true" tabindex="-1"></a>    <span class="fu">require</span><span class="op">(</span>expiration <span class="op">&lt;=</span> block<span class="op">.</span><span class="fu">timestamp</span><span class="op">,</span> <span class="st">&quot;Request is not expired&quot;</span><span class="op">);</span></span>
<span id="cb6-385"><a href="#cb6-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-386"><a href="#cb6-386" aria-hidden="true" tabindex="-1"></a>    delete s_commitments<span class="op">[</span>requestId<span class="op">];</span></span>
<span id="cb6-387"><a href="#cb6-387" aria-hidden="true" tabindex="-1"></a>    emit <span class="fu">CancelOracleRequest</span><span class="op">(</span>requestId<span class="op">);</span></span>
<span id="cb6-388"><a href="#cb6-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-389"><a href="#cb6-389" aria-hidden="true" tabindex="-1"></a>    linkToken<span class="op">.</span><span class="fu">transfer</span><span class="op">(</span>msg<span class="op">.</span><span class="fu">sender</span><span class="op">,</span> payment<span class="op">);</span></span>
<span id="cb6-390"><a href="#cb6-390" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb6-391"><a href="#cb6-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-392"><a href="#cb6-392" aria-hidden="true" tabindex="-1"></a>  <span class="co">/**</span></span>
<span id="cb6-393"><a href="#cb6-393" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="co">@</span>notice Allows requester to cancel requests sent to this oracle contract<span class="co">.</span></span>
<span id="cb6-394"><a href="#cb6-394" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> Will transfer the LINK sent for the request back to the recipient address<span class="co">.</span></span>
<span id="cb6-395"><a href="#cb6-395" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="co">@</span>dev Given params must hash to a commitment stored on the contract in order</span>
<span id="cb6-396"><a href="#cb6-396" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> for the request to be valid<span class="co">.</span> Emits CancelOracleRequest event<span class="co">.</span></span>
<span id="cb6-397"><a href="#cb6-397" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">nonce</span><span class="co"> </span>The nonce used to generate the request ID</span>
<span id="cb6-398"><a href="#cb6-398" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">payment</span><span class="co"> </span>The amount of payment given <span class="co">(</span>specified in wei<span class="co">)</span></span>
<span id="cb6-399"><a href="#cb6-399" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">callbackFunc</span><span class="co"> </span>The requester<span class="co">&#39;</span>s specified callback function selector</span>
<span id="cb6-400"><a href="#cb6-400" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">expiration</span><span class="co"> </span>The time of the expiration for the request</span>
<span id="cb6-401"><a href="#cb6-401" aria-hidden="true" tabindex="-1"></a>   <span class="co">*/</span></span>
<span id="cb6-402"><a href="#cb6-402" aria-hidden="true" tabindex="-1"></a>  function <span class="fu">cancelOracleRequestByRequester</span><span class="op">(</span></span>
<span id="cb6-403"><a href="#cb6-403" aria-hidden="true" tabindex="-1"></a>    uint256 nonce<span class="op">,</span></span>
<span id="cb6-404"><a href="#cb6-404" aria-hidden="true" tabindex="-1"></a>    uint256 payment<span class="op">,</span></span>
<span id="cb6-405"><a href="#cb6-405" aria-hidden="true" tabindex="-1"></a>    bytes4 callbackFunc<span class="op">,</span></span>
<span id="cb6-406"><a href="#cb6-406" aria-hidden="true" tabindex="-1"></a>    uint256 expiration</span>
<span id="cb6-407"><a href="#cb6-407" aria-hidden="true" tabindex="-1"></a>  <span class="op">)</span> external <span class="op">{</span></span>
<span id="cb6-408"><a href="#cb6-408" aria-hidden="true" tabindex="-1"></a>    bytes32 requestId <span class="op">=</span> <span class="fu">keccak256</span><span class="op">(</span>abi<span class="op">.</span><span class="fu">encodePacked</span><span class="op">(</span>msg<span class="op">.</span><span class="fu">sender</span><span class="op">,</span> nonce<span class="op">));</span></span>
<span id="cb6-409"><a href="#cb6-409" aria-hidden="true" tabindex="-1"></a>    bytes31 paramsHash <span class="op">=</span> <span class="fu">_buildParamsHash</span><span class="op">(</span>payment<span class="op">,</span> msg<span class="op">.</span><span class="fu">sender</span><span class="op">,</span> callbackFunc<span class="op">,</span> expiration<span class="op">);</span></span>
<span id="cb6-410"><a href="#cb6-410" aria-hidden="true" tabindex="-1"></a>    <span class="fu">require</span><span class="op">(</span>s_commitments<span class="op">[</span>requestId<span class="op">].</span><span class="fu">paramsHash</span> <span class="op">==</span> paramsHash<span class="op">,</span> <span class="st">&quot;Params do not match request ID&quot;</span><span class="op">);</span></span>
<span id="cb6-411"><a href="#cb6-411" aria-hidden="true" tabindex="-1"></a>    <span class="co">// solhint-disable-next-line not-rely-on-time</span></span>
<span id="cb6-412"><a href="#cb6-412" aria-hidden="true" tabindex="-1"></a>    <span class="fu">require</span><span class="op">(</span>expiration <span class="op">&lt;=</span> block<span class="op">.</span><span class="fu">timestamp</span><span class="op">,</span> <span class="st">&quot;Request is not expired&quot;</span><span class="op">);</span></span>
<span id="cb6-413"><a href="#cb6-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-414"><a href="#cb6-414" aria-hidden="true" tabindex="-1"></a>    delete s_commitments<span class="op">[</span>requestId<span class="op">];</span></span>
<span id="cb6-415"><a href="#cb6-415" aria-hidden="true" tabindex="-1"></a>    emit <span class="fu">CancelOracleRequest</span><span class="op">(</span>requestId<span class="op">);</span></span>
<span id="cb6-416"><a href="#cb6-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-417"><a href="#cb6-417" aria-hidden="true" tabindex="-1"></a>    linkToken<span class="op">.</span><span class="fu">transfer</span><span class="op">(</span>msg<span class="op">.</span><span class="fu">sender</span><span class="op">,</span> payment<span class="op">);</span></span>
<span id="cb6-418"><a href="#cb6-418" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb6-419"><a href="#cb6-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-420"><a href="#cb6-420" aria-hidden="true" tabindex="-1"></a>  <span class="co">/**</span></span>
<span id="cb6-421"><a href="#cb6-421" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="co">@</span>notice Returns the address of the LINK token</span>
<span id="cb6-422"><a href="#cb6-422" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="co">@</span>dev This is the public implementation for chainlinkTokenAddress<span class="co">,</span> which is</span>
<span id="cb6-423"><a href="#cb6-423" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> an internal method of the ChainlinkClient contract</span>
<span id="cb6-424"><a href="#cb6-424" aria-hidden="true" tabindex="-1"></a>   <span class="co">*/</span></span>
<span id="cb6-425"><a href="#cb6-425" aria-hidden="true" tabindex="-1"></a>  function <span class="fu">getChainlinkToken</span><span class="op">()</span> <span class="kw">public</span> view override <span class="fu">returns</span> <span class="op">(</span>address<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-426"><a href="#cb6-426" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">address</span><span class="op">(</span>linkToken<span class="op">);</span></span>
<span id="cb6-427"><a href="#cb6-427" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb6-428"><a href="#cb6-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-429"><a href="#cb6-429" aria-hidden="true" tabindex="-1"></a>  <span class="co">/**</span></span>
<span id="cb6-430"><a href="#cb6-430" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="co">@</span>notice Require that the token transfer action is valid</span>
<span id="cb6-431"><a href="#cb6-431" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="co">@</span>dev OPERATOR_REQUEST_SELECTOR <span class="co">=</span> multiword<span class="co">,</span> ORACLE_REQUEST_SELECTOR <span class="co">=</span> singleword</span>
<span id="cb6-432"><a href="#cb6-432" aria-hidden="true" tabindex="-1"></a>   <span class="co">*/</span></span>
<span id="cb6-433"><a href="#cb6-433" aria-hidden="true" tabindex="-1"></a>  function <span class="fu">_validateTokenTransferAction</span><span class="op">(</span>bytes4 funcSelector<span class="op">,</span> bytes memory data<span class="op">)</span> internal pure override <span class="op">{</span></span>
<span id="cb6-434"><a href="#cb6-434" aria-hidden="true" tabindex="-1"></a>    <span class="fu">require</span><span class="op">(</span>data<span class="op">.</span><span class="fu">length</span> <span class="op">&gt;=</span> MINIMUM_REQUEST_LENGTH<span class="op">,</span> <span class="st">&quot;Invalid request length&quot;</span><span class="op">);</span></span>
<span id="cb6-435"><a href="#cb6-435" aria-hidden="true" tabindex="-1"></a>    <span class="fu">require</span><span class="op">(</span></span>
<span id="cb6-436"><a href="#cb6-436" aria-hidden="true" tabindex="-1"></a>      funcSelector <span class="op">==</span> OPERATOR_REQUEST_SELECTOR <span class="op">||</span> funcSelector <span class="op">==</span> ORACLE_REQUEST_SELECTOR<span class="op">,</span></span>
<span id="cb6-437"><a href="#cb6-437" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;Must use whitelisted functions&quot;</span></span>
<span id="cb6-438"><a href="#cb6-438" aria-hidden="true" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb6-439"><a href="#cb6-439" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb6-440"><a href="#cb6-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-441"><a href="#cb6-441" aria-hidden="true" tabindex="-1"></a>  <span class="co">/**</span></span>
<span id="cb6-442"><a href="#cb6-442" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="co">@</span>notice Verify the Oracle Request and record necessary information</span>
<span id="cb6-443"><a href="#cb6-443" aria-hidden="true" tabindex="-1"></a><span class="co">   * </span><span class="an">@param</span><span class="co"> </span><span class="an">sender</span><span class="co"> </span>The sender of the request</span>
<span id="cb6-444"><a href="#cb6-444" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">payment</span><span class="co"> </span>The amount of payment given <span class="co">(</span>specified in wei<span class="co">)</span></span>
<span id="cb6-445"><a href="#cb6-445" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">callbackAddress</span><span class="co"> </span>The callback address for the response</span>
<span id="cb6-446"><a href="#cb6-446" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">callbackFunctionId</span><span class="co"> </span>The callback function ID for the response</span>
<span id="cb6-447"><a href="#cb6-447" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">nonce</span><span class="co"> </span>The nonce sent by the requester</span>
<span id="cb6-448"><a href="#cb6-448" aria-hidden="true" tabindex="-1"></a>   <span class="co">*/</span></span>
<span id="cb6-449"><a href="#cb6-449" aria-hidden="true" tabindex="-1"></a>  function <span class="fu">_verifyAndProcessOracleRequest</span><span class="op">(</span></span>
<span id="cb6-450"><a href="#cb6-450" aria-hidden="true" tabindex="-1"></a>    address sender<span class="op">,</span></span>
<span id="cb6-451"><a href="#cb6-451" aria-hidden="true" tabindex="-1"></a>    uint256 payment<span class="op">,</span></span>
<span id="cb6-452"><a href="#cb6-452" aria-hidden="true" tabindex="-1"></a>    address callbackAddress<span class="op">,</span></span>
<span id="cb6-453"><a href="#cb6-453" aria-hidden="true" tabindex="-1"></a>    bytes4 callbackFunctionId<span class="op">,</span></span>
<span id="cb6-454"><a href="#cb6-454" aria-hidden="true" tabindex="-1"></a>    uint256 nonce<span class="op">,</span></span>
<span id="cb6-455"><a href="#cb6-455" aria-hidden="true" tabindex="-1"></a>    uint256 dataVersion</span>
<span id="cb6-456"><a href="#cb6-456" aria-hidden="true" tabindex="-1"></a>  <span class="op">)</span> <span class="kw">private</span> <span class="fu">validateNotToLINK</span><span class="op">(</span>callbackAddress<span class="op">)</span> <span class="fu">returns</span> <span class="op">(</span>bytes32 requestId<span class="op">,</span> uint256 expiration<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-457"><a href="#cb6-457" aria-hidden="true" tabindex="-1"></a>    requestId <span class="op">=</span> <span class="fu">keccak256</span><span class="op">(</span>abi<span class="op">.</span><span class="fu">encodePacked</span><span class="op">(</span>sender<span class="op">,</span> nonce<span class="op">));</span></span>
<span id="cb6-458"><a href="#cb6-458" aria-hidden="true" tabindex="-1"></a>    <span class="fu">require</span><span class="op">(</span>s_commitments<span class="op">[</span>requestId<span class="op">].</span><span class="fu">paramsHash</span> <span class="op">==</span> <span class="dv">0</span><span class="op">,</span> <span class="st">&quot;Must use a unique ID&quot;</span><span class="op">);</span></span>
<span id="cb6-459"><a href="#cb6-459" aria-hidden="true" tabindex="-1"></a>    <span class="co">// solhint-disable-next-line not-rely-on-time</span></span>
<span id="cb6-460"><a href="#cb6-460" aria-hidden="true" tabindex="-1"></a>    expiration <span class="op">=</span> block<span class="op">.</span><span class="fu">timestamp</span><span class="op">.</span><span class="fu">add</span><span class="op">(</span>getExpiryTime<span class="op">);</span></span>
<span id="cb6-461"><a href="#cb6-461" aria-hidden="true" tabindex="-1"></a>    bytes31 paramsHash <span class="op">=</span> <span class="fu">_buildParamsHash</span><span class="op">(</span>payment<span class="op">,</span> callbackAddress<span class="op">,</span> callbackFunctionId<span class="op">,</span> expiration<span class="op">);</span></span>
<span id="cb6-462"><a href="#cb6-462" aria-hidden="true" tabindex="-1"></a>    s_commitments<span class="op">[</span>requestId<span class="op">]</span> <span class="op">=</span> <span class="fu">Commitment</span><span class="op">(</span>paramsHash<span class="op">,</span> <span class="fu">_safeCastToUint8</span><span class="op">(</span>dataVersion<span class="op">));</span></span>
<span id="cb6-463"><a href="#cb6-463" aria-hidden="true" tabindex="-1"></a>    s_tokensInEscrow <span class="op">=</span> s_tokensInEscrow<span class="op">.</span><span class="fu">add</span><span class="op">(</span>payment<span class="op">);</span></span>
<span id="cb6-464"><a href="#cb6-464" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">(</span>requestId<span class="op">,</span> expiration<span class="op">);</span></span>
<span id="cb6-465"><a href="#cb6-465" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb6-466"><a href="#cb6-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-467"><a href="#cb6-467" aria-hidden="true" tabindex="-1"></a>  <span class="co">/**</span></span>
<span id="cb6-468"><a href="#cb6-468" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="co">@</span>notice Verify the Oracle request and unlock escrowed payment</span>
<span id="cb6-469"><a href="#cb6-469" aria-hidden="true" tabindex="-1"></a><span class="co">   * </span><span class="an">@param</span><span class="co"> </span><span class="an">requestId</span><span class="co"> </span>The fulfillment request ID that must match the requester<span class="co">&#39;</span>s</span>
<span id="cb6-470"><a href="#cb6-470" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">payment</span><span class="co"> </span>The payment amount that will be released for the oracle <span class="co">(</span>specified in wei<span class="co">)</span></span>
<span id="cb6-471"><a href="#cb6-471" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">callbackAddress</span><span class="co"> </span>The callback address to call for fulfillment</span>
<span id="cb6-472"><a href="#cb6-472" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">callbackFunctionId</span><span class="co"> </span>The callback function ID to use for fulfillment</span>
<span id="cb6-473"><a href="#cb6-473" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">expiration</span><span class="co"> </span>The expiration that the node should respond by before the requester can cancel</span>
<span id="cb6-474"><a href="#cb6-474" aria-hidden="true" tabindex="-1"></a>   <span class="co">*/</span></span>
<span id="cb6-475"><a href="#cb6-475" aria-hidden="true" tabindex="-1"></a>  function <span class="fu">_verifyOracleRequestAndProcessPayment</span><span class="op">(</span></span>
<span id="cb6-476"><a href="#cb6-476" aria-hidden="true" tabindex="-1"></a>    bytes32 requestId<span class="op">,</span></span>
<span id="cb6-477"><a href="#cb6-477" aria-hidden="true" tabindex="-1"></a>    uint256 payment<span class="op">,</span></span>
<span id="cb6-478"><a href="#cb6-478" aria-hidden="true" tabindex="-1"></a>    address callbackAddress<span class="op">,</span></span>
<span id="cb6-479"><a href="#cb6-479" aria-hidden="true" tabindex="-1"></a>    bytes4 callbackFunctionId<span class="op">,</span></span>
<span id="cb6-480"><a href="#cb6-480" aria-hidden="true" tabindex="-1"></a>    uint256 expiration<span class="op">,</span></span>
<span id="cb6-481"><a href="#cb6-481" aria-hidden="true" tabindex="-1"></a>    uint256 dataVersion</span>
<span id="cb6-482"><a href="#cb6-482" aria-hidden="true" tabindex="-1"></a>  <span class="op">)</span> internal <span class="op">{</span></span>
<span id="cb6-483"><a href="#cb6-483" aria-hidden="true" tabindex="-1"></a>    bytes31 paramsHash <span class="op">=</span> <span class="fu">_buildParamsHash</span><span class="op">(</span>payment<span class="op">,</span> callbackAddress<span class="op">,</span> callbackFunctionId<span class="op">,</span> expiration<span class="op">);</span></span>
<span id="cb6-484"><a href="#cb6-484" aria-hidden="true" tabindex="-1"></a>    <span class="fu">require</span><span class="op">(</span>s_commitments<span class="op">[</span>requestId<span class="op">].</span><span class="fu">paramsHash</span> <span class="op">==</span> paramsHash<span class="op">,</span> <span class="st">&quot;Params do not match request ID&quot;</span><span class="op">);</span></span>
<span id="cb6-485"><a href="#cb6-485" aria-hidden="true" tabindex="-1"></a>    <span class="fu">require</span><span class="op">(</span>s_commitments<span class="op">[</span>requestId<span class="op">].</span><span class="fu">dataVersion</span> <span class="op">&lt;=</span> <span class="fu">_safeCastToUint8</span><span class="op">(</span>dataVersion<span class="op">),</span> <span class="st">&quot;Data versions must match&quot;</span><span class="op">);</span></span>
<span id="cb6-486"><a href="#cb6-486" aria-hidden="true" tabindex="-1"></a>    s_tokensInEscrow <span class="op">=</span> s_tokensInEscrow<span class="op">.</span><span class="fu">sub</span><span class="op">(</span>payment<span class="op">);</span></span>
<span id="cb6-487"><a href="#cb6-487" aria-hidden="true" tabindex="-1"></a>    delete s_commitments<span class="op">[</span>requestId<span class="op">];</span></span>
<span id="cb6-488"><a href="#cb6-488" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb6-489"><a href="#cb6-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-490"><a href="#cb6-490" aria-hidden="true" tabindex="-1"></a>  <span class="co">/**</span></span>
<span id="cb6-491"><a href="#cb6-491" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="co">@</span>notice Build the bytes31 hash from the payment<span class="co">,</span> callback and expiration<span class="co">.</span></span>
<span id="cb6-492"><a href="#cb6-492" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">payment</span><span class="co"> </span>The payment amount that will be released for the oracle <span class="co">(</span>specified in wei<span class="co">)</span></span>
<span id="cb6-493"><a href="#cb6-493" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">callbackAddress</span><span class="co"> </span>The callback address to call for fulfillment</span>
<span id="cb6-494"><a href="#cb6-494" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">callbackFunctionId</span><span class="co"> </span>The callback function ID to use for fulfillment</span>
<span id="cb6-495"><a href="#cb6-495" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">expiration</span><span class="co"> </span>The expiration that the node should respond by before the requester can cancel</span>
<span id="cb6-496"><a href="#cb6-496" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@return</span> hash bytes31</span>
<span id="cb6-497"><a href="#cb6-497" aria-hidden="true" tabindex="-1"></a>   <span class="co">*/</span></span>
<span id="cb6-498"><a href="#cb6-498" aria-hidden="true" tabindex="-1"></a>  function <span class="fu">_buildParamsHash</span><span class="op">(</span></span>
<span id="cb6-499"><a href="#cb6-499" aria-hidden="true" tabindex="-1"></a>    uint256 payment<span class="op">,</span></span>
<span id="cb6-500"><a href="#cb6-500" aria-hidden="true" tabindex="-1"></a>    address callbackAddress<span class="op">,</span></span>
<span id="cb6-501"><a href="#cb6-501" aria-hidden="true" tabindex="-1"></a>    bytes4 callbackFunctionId<span class="op">,</span></span>
<span id="cb6-502"><a href="#cb6-502" aria-hidden="true" tabindex="-1"></a>    uint256 expiration</span>
<span id="cb6-503"><a href="#cb6-503" aria-hidden="true" tabindex="-1"></a>  <span class="op">)</span> internal pure <span class="fu">returns</span> <span class="op">(</span>bytes31<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-504"><a href="#cb6-504" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">bytes31</span><span class="op">(</span><span class="fu">keccak256</span><span class="op">(</span>abi<span class="op">.</span><span class="fu">encodePacked</span><span class="op">(</span>payment<span class="op">,</span> callbackAddress<span class="op">,</span> callbackFunctionId<span class="op">,</span> expiration<span class="op">)));</span></span>
<span id="cb6-505"><a href="#cb6-505" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb6-506"><a href="#cb6-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-507"><a href="#cb6-507" aria-hidden="true" tabindex="-1"></a>  <span class="co">/**</span></span>
<span id="cb6-508"><a href="#cb6-508" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="co">@</span>notice Safely cast uint256 to uint8</span>
<span id="cb6-509"><a href="#cb6-509" aria-hidden="true" tabindex="-1"></a><span class="co">   * </span><span class="an">@param</span><span class="co"> </span><span class="an">number</span><span class="co"> </span>uint256</span>
<span id="cb6-510"><a href="#cb6-510" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@return</span> uint8 number</span>
<span id="cb6-511"><a href="#cb6-511" aria-hidden="true" tabindex="-1"></a>   <span class="co">*/</span></span>
<span id="cb6-512"><a href="#cb6-512" aria-hidden="true" tabindex="-1"></a>  function <span class="fu">_safeCastToUint8</span><span class="op">(</span>uint256 number<span class="op">)</span> internal pure <span class="fu">returns</span> <span class="op">(</span>uint8<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-513"><a href="#cb6-513" aria-hidden="true" tabindex="-1"></a>    <span class="fu">require</span><span class="op">(</span>number <span class="op">&lt;</span> MAXIMUM_DATA_VERSION<span class="op">,</span> <span class="st">&quot;number too big to cast&quot;</span><span class="op">);</span></span>
<span id="cb6-514"><a href="#cb6-514" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">uint8</span><span class="op">(</span>number<span class="op">);</span></span>
<span id="cb6-515"><a href="#cb6-515" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb6-516"><a href="#cb6-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-517"><a href="#cb6-517" aria-hidden="true" tabindex="-1"></a>  <span class="co">/**</span></span>
<span id="cb6-518"><a href="#cb6-518" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="co">@</span>notice Returns the LINK available in this contract<span class="co">,</span> not locked in escrow</span>
<span id="cb6-519"><a href="#cb6-519" aria-hidden="true" tabindex="-1"></a><span class="co">   * </span><span class="an">@return</span> uint256 LINK tokens available</span>
<span id="cb6-520"><a href="#cb6-520" aria-hidden="true" tabindex="-1"></a>   <span class="co">*/</span></span>
<span id="cb6-521"><a href="#cb6-521" aria-hidden="true" tabindex="-1"></a>  function <span class="fu">_fundsAvailable</span><span class="op">()</span> <span class="kw">private</span> view <span class="fu">returns</span> <span class="op">(</span>uint256<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-522"><a href="#cb6-522" aria-hidden="true" tabindex="-1"></a>    uint256 inEscrow <span class="op">=</span> s_tokensInEscrow<span class="op">.</span><span class="fu">sub</span><span class="op">(</span>ONE_FOR_CONSISTENT_GAS_COST<span class="op">);</span></span>
<span id="cb6-523"><a href="#cb6-523" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> linkToken<span class="op">.</span><span class="fu">balanceOf</span><span class="op">(</span><span class="fu">address</span><span class="op">(</span><span class="kw">this</span><span class="op">)).</span><span class="fu">sub</span><span class="op">(</span>inEscrow<span class="op">);</span></span>
<span id="cb6-524"><a href="#cb6-524" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb6-525"><a href="#cb6-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-526"><a href="#cb6-526" aria-hidden="true" tabindex="-1"></a>  <span class="co">/**</span></span>
<span id="cb6-527"><a href="#cb6-527" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="co">@</span>notice concrete implementation of AuthorizedReceiver</span>
<span id="cb6-528"><a href="#cb6-528" aria-hidden="true" tabindex="-1"></a><span class="co">   * </span><span class="an">@return</span> bool of whether sender is authorized</span>
<span id="cb6-529"><a href="#cb6-529" aria-hidden="true" tabindex="-1"></a>   <span class="co">*/</span></span>
<span id="cb6-530"><a href="#cb6-530" aria-hidden="true" tabindex="-1"></a>  function <span class="fu">_canSetAuthorizedSenders</span><span class="op">()</span> internal view override <span class="fu">returns</span> <span class="op">(</span>bool<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-531"><a href="#cb6-531" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">isAuthorizedSender</span><span class="op">(</span>msg<span class="op">.</span><span class="fu">sender</span><span class="op">)</span> <span class="op">||</span> <span class="fu">owner</span><span class="op">()</span> <span class="op">==</span> msg<span class="op">.</span><span class="fu">sender</span><span class="op">;</span></span>
<span id="cb6-532"><a href="#cb6-532" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb6-533"><a href="#cb6-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-534"><a href="#cb6-534" aria-hidden="true" tabindex="-1"></a>  <span class="co">// MODIFIERS</span></span>
<span id="cb6-535"><a href="#cb6-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-536"><a href="#cb6-536" aria-hidden="true" tabindex="-1"></a>  <span class="co">/**</span></span>
<span id="cb6-537"><a href="#cb6-537" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="co">@</span>dev Reverts if the first <span class="co">32</span> bytes of the bytes array is not equal to requestId</span>
<span id="cb6-538"><a href="#cb6-538" aria-hidden="true" tabindex="-1"></a><span class="co">   * </span><span class="an">@param</span><span class="co"> </span><span class="an">requestId</span><span class="co"> </span>bytes32</span>
<span id="cb6-539"><a href="#cb6-539" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">data</span><span class="co"> </span>bytes</span>
<span id="cb6-540"><a href="#cb6-540" aria-hidden="true" tabindex="-1"></a>   <span class="co">*/</span></span>
<span id="cb6-541"><a href="#cb6-541" aria-hidden="true" tabindex="-1"></a>  modifier <span class="fu">validateMultiWordResponseId</span><span class="op">(</span>bytes32 requestId<span class="op">,</span> bytes calldata data<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-542"><a href="#cb6-542" aria-hidden="true" tabindex="-1"></a>    <span class="fu">require</span><span class="op">(</span>data<span class="op">.</span><span class="fu">length</span> <span class="op">&gt;=</span> <span class="dv">32</span><span class="op">,</span> <span class="st">&quot;Response must be &gt; 32 bytes&quot;</span><span class="op">);</span></span>
<span id="cb6-543"><a href="#cb6-543" aria-hidden="true" tabindex="-1"></a>    bytes32 firstDataWord<span class="op">;</span></span>
<span id="cb6-544"><a href="#cb6-544" aria-hidden="true" tabindex="-1"></a>    assembly <span class="op">{</span></span>
<span id="cb6-545"><a href="#cb6-545" aria-hidden="true" tabindex="-1"></a>      firstDataWord <span class="op">:=</span> <span class="fu">calldataload</span><span class="op">(</span>data<span class="op">.</span><span class="fu">offset</span><span class="op">)</span></span>
<span id="cb6-546"><a href="#cb6-546" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb6-547"><a href="#cb6-547" aria-hidden="true" tabindex="-1"></a>    <span class="fu">require</span><span class="op">(</span>requestId <span class="op">==</span> firstDataWord<span class="op">,</span> <span class="st">&quot;First word must be requestId&quot;</span><span class="op">);</span></span>
<span id="cb6-548"><a href="#cb6-548" aria-hidden="true" tabindex="-1"></a>    _<span class="op">;</span></span>
<span id="cb6-549"><a href="#cb6-549" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb6-550"><a href="#cb6-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-551"><a href="#cb6-551" aria-hidden="true" tabindex="-1"></a>  <span class="co">/**</span></span>
<span id="cb6-552"><a href="#cb6-552" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="co">@</span>dev Reverts if amount requested is greater than withdrawable balance</span>
<span id="cb6-553"><a href="#cb6-553" aria-hidden="true" tabindex="-1"></a><span class="co">   * </span><span class="an">@param</span><span class="co"> </span><span class="an">amount</span><span class="co"> </span>The given amount to compare to <span class="co">`</span>s_withdrawableTokens<span class="co">`</span></span>
<span id="cb6-554"><a href="#cb6-554" aria-hidden="true" tabindex="-1"></a>   <span class="co">*/</span></span>
<span id="cb6-555"><a href="#cb6-555" aria-hidden="true" tabindex="-1"></a>  modifier <span class="fu">validateAvailableFunds</span><span class="op">(</span>uint256 amount<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-556"><a href="#cb6-556" aria-hidden="true" tabindex="-1"></a>    <span class="fu">require</span><span class="op">(</span><span class="fu">_fundsAvailable</span><span class="op">()</span> <span class="op">&gt;=</span> amount<span class="op">,</span> <span class="st">&quot;Amount requested is greater than withdrawable balance&quot;</span><span class="op">);</span></span>
<span id="cb6-557"><a href="#cb6-557" aria-hidden="true" tabindex="-1"></a>    _<span class="op">;</span></span>
<span id="cb6-558"><a href="#cb6-558" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb6-559"><a href="#cb6-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-560"><a href="#cb6-560" aria-hidden="true" tabindex="-1"></a>  <span class="co">/**</span></span>
<span id="cb6-561"><a href="#cb6-561" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="co">@</span>dev Reverts if request ID does not exist</span>
<span id="cb6-562"><a href="#cb6-562" aria-hidden="true" tabindex="-1"></a><span class="co">   * </span><span class="an">@param</span><span class="co"> </span><span class="an">requestId</span><span class="co"> </span>The given request ID to check in stored <span class="co">`</span>commitments<span class="co">`</span></span>
<span id="cb6-563"><a href="#cb6-563" aria-hidden="true" tabindex="-1"></a>   <span class="co">*/</span></span>
<span id="cb6-564"><a href="#cb6-564" aria-hidden="true" tabindex="-1"></a>  modifier <span class="fu">validateRequestId</span><span class="op">(</span>bytes32 requestId<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-565"><a href="#cb6-565" aria-hidden="true" tabindex="-1"></a>    <span class="fu">require</span><span class="op">(</span>s_commitments<span class="op">[</span>requestId<span class="op">].</span><span class="fu">paramsHash</span> <span class="op">!=</span> <span class="dv">0</span><span class="op">,</span> <span class="st">&quot;Must have a valid requestId&quot;</span><span class="op">);</span></span>
<span id="cb6-566"><a href="#cb6-566" aria-hidden="true" tabindex="-1"></a>    _<span class="op">;</span></span>
<span id="cb6-567"><a href="#cb6-567" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb6-568"><a href="#cb6-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-569"><a href="#cb6-569" aria-hidden="true" tabindex="-1"></a>  <span class="co">/**</span></span>
<span id="cb6-570"><a href="#cb6-570" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="co">@</span>dev Reverts if the callback address is the LINK token</span>
<span id="cb6-571"><a href="#cb6-571" aria-hidden="true" tabindex="-1"></a><span class="co">   * </span><span class="an">@param</span><span class="co"> </span><span class="an">to</span><span class="co"> </span>The callback address</span>
<span id="cb6-572"><a href="#cb6-572" aria-hidden="true" tabindex="-1"></a>   <span class="co">*/</span></span>
<span id="cb6-573"><a href="#cb6-573" aria-hidden="true" tabindex="-1"></a>  modifier <span class="fu">validateNotToLINK</span><span class="op">(</span>address to<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-574"><a href="#cb6-574" aria-hidden="true" tabindex="-1"></a>    <span class="fu">require</span><span class="op">(</span>to <span class="op">!=</span> <span class="fu">address</span><span class="op">(</span>linkToken<span class="op">),</span> <span class="st">&quot;Cannot call to LINK&quot;</span><span class="op">);</span></span>
<span id="cb6-575"><a href="#cb6-575" aria-hidden="true" tabindex="-1"></a>    _<span class="op">;</span></span>
<span id="cb6-576"><a href="#cb6-576" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb6-577"><a href="#cb6-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-578"><a href="#cb6-578" aria-hidden="true" tabindex="-1"></a>  <span class="co">/**</span></span>
<span id="cb6-579"><a href="#cb6-579" aria-hidden="true" tabindex="-1"></a>   <span class="co">*</span> <span class="co">@</span>dev Reverts if the target address is owned by the operator</span>
<span id="cb6-580"><a href="#cb6-580" aria-hidden="true" tabindex="-1"></a>   <span class="co">*/</span></span>
<span id="cb6-581"><a href="#cb6-581" aria-hidden="true" tabindex="-1"></a>  modifier <span class="fu">validateCallbackAddress</span><span class="op">(</span>address callbackAddress<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-582"><a href="#cb6-582" aria-hidden="true" tabindex="-1"></a>    <span class="fu">require</span><span class="op">(!</span>s_owned<span class="op">[</span>callbackAddress<span class="op">],</span> <span class="st">&quot;Cannot call owned contract&quot;</span><span class="op">);</span></span>
<span id="cb6-583"><a href="#cb6-583" aria-hidden="true" tabindex="-1"></a>    _<span class="op">;</span></span>
<span id="cb6-584"><a href="#cb6-584" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb6-585"><a href="#cb6-585" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong><a
href="https://docs.chain.link/resources/link-token-contracts">ChainLink
Contract Addresses:</a></strong></p>
<p><strong>Goerli Testnet:
0x326C977E6efc84E512bB9C30f76E30c160eD06FB</strong> <strong>Ethereum
Mainnet: 0x514910771AF9Ca656af840dff83E8264EcF986CA</strong> Set ‚ÄòLINK‚Äô
0x326C977E6efc84E512bB9C30f76E30c160eD06FB Goerli Token Testnet contract
and ‚ÄòOWNER‚Äô (Wallet Address) values and click transact. <img
src="../../link/files/images/deploy_contract.jpg" /></p>
<p><strong>Note: the output shows your newly deployed operator smart
contract: 0xfc5F20476E6289c7120A89D45e383EB28603152f</strong></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">[view</span> on etherscan]<span class="er">(</span><span class="ex">https://goerli.etherscan.io/tx/0xebeea65d9e90c804b049a8d34e115f88ea14ea49b267d2843a2e2ef8f0ee7382</span><span class="kw">)</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="ex">[block:9412412</span> txIndex:11]from: 0x0f0...f05E5to: Operator.<span class="er">(</span><span class="ex">constructor</span><span class="kw">)</span><span class="ex">value:</span> 0 weidata: 0x60a...f05e5logs: 0hash: 0xfd1...938e7</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="ex">status</span>  true Transaction mined and execution succeed</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="ex">transaction</span> hash    0xebeea65d9e90c804b049a8d34e115f88ea14ea49b267d2843a2e2ef8f0ee7382</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="ex">block</span> hash  0xfd1c521f5cbd50873b056f5a34176ae2f33137abf326ca15b878c15fdc3938e7</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="ex">block</span> number    9412412</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="ex">contract</span> address    0xfc5F20476E6289c7120A89D45e383EB28603152f</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="ex">from</span>    0x0f0d2BF29AAe4E6D8d646F967Df8c49B28Df05E5</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="ex">to</span>  Operator.<span class="er">(</span><span class="ex">constructor</span><span class="kw">)</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="ex">gas</span> 3754948 gas</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="ex">transaction</span> cost    3754948 gas </span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="ex">input</span>   0x60a...f05e5</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="ex">decoded</span> input   {</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;address link&quot;</span><span class="ex">:</span> <span class="st">&quot;0x326C977E6efc84E512bB9C30f76E30c160eD06FB&quot;</span>,</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;address owner&quot;</span><span class="ex">:</span> <span class="st">&quot;0x0f0d2BF29AAe4E6D8d646F967Df8c49B28Df05E5&quot;</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<p><strong>Copy your Chainlink node address from Operator ui under
‚Äòsettings‚Äô &amp; ‚Äòkey management‚Äô:
0x321f40D5D7f678A35DCfC15Df852135F2c53e1AA</strong> <img
src="../../link/files/images/ChainLink_Operator.jpg" /></p>
<p><a
href="https://github.com/smartcontractkit/chainlink/blob/develop/contracts/src/v0.7/Operator.sol">Chainlink
Smart Contract (v0.7) that we deployed on GitHub</a> With the Following
fuctions: <img src="../chainlink/images/deployed_contract.jpg" /></p>
<p>and call the functions ‚ÄòsetAuthorizedSenders‚Äô &amp;
‚ÄòisAuthorizedSender‚Äô with the address of your node (in my case the
array: ‚Äò[‚Äú0x321f40D5D7f678A35DCfC15Df852135F2c53e1AA‚Äù]‚Äô) to verify that
your chainlink node address can call the operator contract. The function
must return true. You can use Remix IDE or instead Etherscan:
https://goerli.etherscan.io/address/0xfc5f20476e6289c7120a89d45e383eb28603152f#writeContract</p>
<p><img src="../../link/files/images/Etherscan_CSC.jpg" /></p>
<h1 id="add-a-job-to-your-node">Add a Job to your Node</h1>
<p>To be able to earn Link rewards You will create a job that calls an
OpenAPI, parses the response and then return a uint256 In the Chainlink
Operator UI on the Jobs tab, click New Job and replace the
‚ÄòcontractAdress‚Äô with the newly deployd ChainLink Smart Contract
‚Äò0x2174C8be4fb7dF9C7c42318643579c3E994CA343‚Äô</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span> = <span class="st">&quot;directrequest&quot;</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="ex">schemaVersion</span> = 1</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="ex">name</span> = <span class="st">&quot;Get &gt; Price&quot;</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="ex">externalJobID</span> = <span class="st">&quot;6e391cc2-97de-4008-a630-edb1057c3f9c&quot;</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="ex">forwardingAllowed</span> = false</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="ex">maxTaskDuration</span> = <span class="st">&quot;0s&quot;</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="ex">contractAddress</span> = <span class="st">&quot;0x2174C8be4fb7dF9C7c42318643579c3E994CA343&quot;</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="ex">minContractPaymentLinkJuels</span> = <span class="st">&quot;0&quot;</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="ex">observationSource</span> = <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="st">    decode_log   [type=&quot;</span>ethabidecodelog<span class="st">&quot;</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="st">                  abi=&quot;</span>OracleRequest<span class="er">(</span><span class="ex">bytes32</span> indexed specId, address requester, bytes32 requestId, uint256 payment, address callbackAddr, bytes4 callbackFunctionId, uint256 cancelExpiration, uint256 dataVersion, bytes data<span class="kw">)</span><span class="st">&quot;</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="st">                  data=&quot;</span><span class="va">$(</span><span class="ex">jobRun.logData</span><span class="va">)</span><span class="st">&quot;</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="st">                  topics=&quot;</span><span class="va">$(</span><span class="ex">jobRun.logTopics</span><span class="va">)</span><span class="st">&quot;]</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="st">    decode_cbor  [type=&quot;</span><span class="ex">cborparse</span><span class="st">&quot; data=&quot;</span><span class="va">$(</span><span class="ex">decode_log.data</span><span class="va">)</span><span class="st">&quot;]</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="st">    fetch        [type=&quot;</span><span class="ex">http</span><span class="st">&quot; method=GET url=&quot;</span><span class="va">$(</span><span class="ex">decode_cbor.get</span><span class="va">)</span><span class="st">&quot; allowUnrestrictedNetworkAccess=&quot;</span><span class="ex">true</span><span class="st">&quot;]</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="st">    parse        [type=&quot;</span><span class="ex">jsonparse</span><span class="st">&quot; path=&quot;</span><span class="va">$(</span><span class="ex">decode_cbor.path</span><span class="va">)</span><span class="st">&quot; data=&quot;</span><span class="va">$(</span><span class="ex">fetch</span><span class="va">)</span><span class="st">&quot;]</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="st">    multiply     [type=&quot;</span><span class="ex">multiply</span><span class="st">&quot; input=&quot;</span><span class="va">$(</span><span class="ex">parse</span><span class="va">)</span><span class="st">&quot; times=&quot;</span><span class="va">$(</span><span class="ex">decode_cbor.times</span><span class="va">)</span><span class="st">&quot;]</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="st">    encode_data  [type=&quot;</span><span class="ex">ethabiencode</span><span class="st">&quot; abi=&quot;</span><span class="er">(</span><span class="ex">bytes32</span> requestId, uint256 value<span class="kw">)</span><span class="st">&quot; data=&quot;</span><span class="ex">{</span> <span class="dt">\\</span><span class="st">&quot;requestId</span><span class="dt">\\</span><span class="st">&quot;</span>: <span class="va">$(</span><span class="ex">decode_log.requestId</span><span class="va">)</span>, <span class="dt">\\</span><span class="st">&quot;value</span><span class="dt">\\</span><span class="st">&quot;</span>: <span class="va">$(</span><span class="ex">multiply</span><span class="va">)</span> }<span class="st">&quot;]</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="st">    encode_tx    [type=&quot;</span>ethabiencode<span class="st">&quot;</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="st">                  abi=&quot;</span>fulfillOracleRequest2<span class="er">(</span><span class="ex">bytes32</span> requestId, uint256 payment, address callbackAddress, bytes4 callbackFunctionId, uint256 expiration, bytes calldata data<span class="kw">)</span><span class="st">&quot;</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a><span class="st">                  data=&quot;</span><span class="ex">{\\</span><span class="st">&quot;requestId</span><span class="dt">\\</span><span class="st">&quot;</span><span class="ex">:</span> <span class="va">$(</span><span class="ex">decode_log.requestId</span><span class="va">)</span>, <span class="dt">\\</span><span class="st">&quot;payment</span><span class="dt">\\</span><span class="st">&quot;</span>:   <span class="va">$(</span><span class="ex">decode_log.payment</span><span class="va">)</span>, <span class="dt">\\</span><span class="st">&quot;callbackAddress</span><span class="dt">\\</span><span class="st">&quot;</span>: <span class="va">$(</span><span class="ex">decode_log.callbackAddr</span><span class="va">)</span>, <span class="dt">\\</span><span class="st">&quot;callbackFunctionId</span><span class="dt">\\</span><span class="st">&quot;</span>: <span class="va">$(</span><span class="ex">decode_log.callbackFunctionId</span><span class="va">)</span>, <span class="dt">\\</span><span class="st">&quot;expiration</span><span class="dt">\\</span><span class="st">&quot;</span>: <span class="va">$(</span><span class="ex">decode_log.cancelExpiration</span><span class="va">)</span>, <span class="dt">\\</span><span class="st">&quot;data</span><span class="dt">\\</span><span class="st">&quot;</span>: <span class="va">$(</span><span class="ex">encode_data</span><span class="va">)</span>}<span class="st">&quot;</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="st">                  ]</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a><span class="st">    submit_tx    [type=&quot;</span>ethtx<span class="st">&quot; to=&quot;</span>0x2174C8be4fb7dF9C7c42318643579c3E994CA343<span class="st">&quot; data=&quot;</span><span class="va">$(</span><span class="ex">encode_tx</span><span class="va">)</span><span class="st">&quot;]</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a><span class="st">    decode_log -&gt; decode_cbor -&gt; fetch -&gt; parse -&gt; multiply -&gt; encode_data -&gt; encode_tx -&gt; submit_tx</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;&quot;&quot;</span></span></code></pre></div>
<p>https://goerli.etherscan.io/address/0x5fa7f2926bd6f490cfcf29245cd3f7bb29a8ceed#writeContract</p>
<p>**Copy your External _jobId: 6e391cc2-97de-4008-a630-edb1057c3f9c
without dashes for the consumer contract**</p>
<h1 id="create-testnet-consumer-contract">create testnet consumer
contract</h1>
<p>https://remix.ethereum.org/#url=https://docs.chain.link/samples/APIRequests/ATestnetConsumer.sol&amp;lang=en&amp;optimize=false&amp;runs=200&amp;evmVersion=null&amp;version=soljson-v0.8.18+commit.87f61d96.js</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode java"><code class="sourceCode java"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">// </span><span class="an">SPDX-License-Identifier:</span><span class="co"> MIT</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>pragma solidity <span class="op">^</span><span class="fl">0.8.7</span><span class="op">;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">&quot;@chainlink/contracts/src/v0</span><span class="op">.</span><span class="im">8/ChainlinkClient</span><span class="op">.</span><span class="im">sol&quot;</span><span class="op">;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">&quot;@chainlink/contracts/src/v0</span><span class="op">.</span><span class="im">8/ConfirmedOwner</span><span class="op">.</span><span class="im">sol&quot;</span><span class="op">;</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> THIS IS AN EXAMPLE CONTRACT THAT USES UN<span class="co">-</span>AUDITED CODE<span class="co">.</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> DO NOT USE THIS CODE IN PRODUCTION<span class="co">.</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>contract ATestnetConsumer is ChainlinkClient<span class="op">,</span> ConfirmedOwner <span class="op">{</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    using Chainlink <span class="cf">for</span> Chainlink<span class="op">.</span><span class="fu">Request</span><span class="op">;</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    uint256 <span class="kw">private</span> constant ORACLE_PAYMENT <span class="op">=</span> <span class="op">(</span><span class="dv">1</span> <span class="op">*</span> LINK_DIVISIBILITY<span class="op">)</span> <span class="op">/</span> <span class="dv">10</span><span class="op">;</span> <span class="co">// 0.1 * 10**18</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    uint256 <span class="kw">public</span> currentPrice<span class="op">;</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    event <span class="fu">RequestEthereumPriceFulfilled</span><span class="op">(</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>        bytes32 indexed requestId<span class="op">,</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>        uint256 indexed price</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">/**</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>     <span class="co">*</span>  Sepolia</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>     <span class="co">*@</span>dev LINK address in Goerli network<span class="co">:</span> <span class="co">0x326C977E6efc84E512bB9C30f76E30c160eD06FB</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>     <span class="co">*</span> <span class="co">@</span>dev Check https<span class="co">://</span>docs<span class="co">.</span>chain<span class="co">.</span>link<span class="co">/</span>docs<span class="co">/</span>link<span class="co">-</span>token<span class="co">-</span>contracts<span class="co">/</span> for LINK address for the right network</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>     <span class="co">*/</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">constructor</span><span class="op">()</span> <span class="fu">ConfirmedOwner</span><span class="op">(</span>msg<span class="op">.</span><span class="fu">sender</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">setChainlinkToken</span><span class="op">(</span><span class="bn">0x326C977E6efc84E512bB9C30f76E30c160eD06FB</span><span class="op">);</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>    function <span class="fu">requestEthereumPrice</span><span class="op">(</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>        address _oracle<span class="op">,</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>        string memory _jobId</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>    <span class="op">)</span> <span class="kw">public</span> onlyOwner <span class="op">{</span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>        Chainlink<span class="op">.</span><span class="fu">Request</span> memory req <span class="op">=</span> <span class="fu">buildChainlinkRequest</span><span class="op">(</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stringToBytes32</span><span class="op">(</span>_jobId<span class="op">),</span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>            <span class="fu">address</span><span class="op">(</span><span class="kw">this</span><span class="op">),</span></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>            <span class="kw">this</span><span class="op">.</span><span class="fu">fulfillEthereumPrice</span><span class="op">.</span><span class="fu">selector</span></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>        <span class="op">);</span></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>        req<span class="op">.</span><span class="fu">add</span><span class="op">(</span></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;get&quot;</span><span class="op">,</span></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;https://min-api.cryptocompare.com/data/price?fsym=ETH&amp;tsyms=USD&quot;</span></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>        <span class="op">);</span></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>        req<span class="op">.</span><span class="fu">add</span><span class="op">(</span><span class="st">&quot;path&quot;</span><span class="op">,</span> <span class="st">&quot;USD&quot;</span><span class="op">);</span></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>        req<span class="op">.</span><span class="fu">addInt</span><span class="op">(</span><span class="st">&quot;times&quot;</span><span class="op">,</span> <span class="dv">100</span><span class="op">);</span></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sendChainlinkRequestTo</span><span class="op">(</span>_oracle<span class="op">,</span> req<span class="op">,</span> ORACLE_PAYMENT<span class="op">);</span></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>    function <span class="fu">fulfillEthereumPrice</span><span class="op">(</span></span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>        bytes32 _requestId<span class="op">,</span></span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>        uint256 _price</span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>    <span class="op">)</span> <span class="kw">public</span> <span class="fu">recordChainlinkFulfillment</span><span class="op">(</span>_requestId<span class="op">)</span> <span class="op">{</span></span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>        emit <span class="fu">RequestEthereumPriceFulfilled</span><span class="op">(</span>_requestId<span class="op">,</span> _price<span class="op">);</span></span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>        currentPrice <span class="op">=</span> _price<span class="op">;</span></span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>    function <span class="fu">getChainlinkToken</span><span class="op">()</span> <span class="kw">public</span> view <span class="fu">returns</span> <span class="op">(</span>address<span class="op">)</span> <span class="op">{</span></span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="fu">chainlinkTokenAddress</span><span class="op">();</span></span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a>    function <span class="fu">withdrawLink</span><span class="op">()</span> <span class="kw">public</span> onlyOwner <span class="op">{</span></span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a>        LinkTokenInterface link <span class="op">=</span> <span class="fu">LinkTokenInterface</span><span class="op">(</span><span class="fu">chainlinkTokenAddress</span><span class="op">());</span></span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a>        <span class="fu">require</span><span class="op">(</span></span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>            link<span class="op">.</span><span class="fu">transfer</span><span class="op">(</span>msg<span class="op">.</span><span class="fu">sender</span><span class="op">,</span> link<span class="op">.</span><span class="fu">balanceOf</span><span class="op">(</span><span class="fu">address</span><span class="op">(</span><span class="kw">this</span><span class="op">))),</span></span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Unable to transfer&quot;</span></span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a>        <span class="op">);</span></span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a>    function <span class="fu">cancelRequest</span><span class="op">(</span></span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a>        bytes32 _requestId<span class="op">,</span></span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a>        uint256 _payment<span class="op">,</span></span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a>        bytes4 _callbackFunctionId<span class="op">,</span></span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a>        uint256 _expiration</span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a>    <span class="op">)</span> <span class="kw">public</span> onlyOwner <span class="op">{</span></span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cancelChainlinkRequest</span><span class="op">(</span></span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a>            _requestId<span class="op">,</span></span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a>            _payment<span class="op">,</span></span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a>            _callbackFunctionId<span class="op">,</span></span>
<span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a>            _expiration</span>
<span id="cb9-81"><a href="#cb9-81" aria-hidden="true" tabindex="-1"></a>        <span class="op">);</span></span>
<span id="cb9-82"><a href="#cb9-82" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb9-83"><a href="#cb9-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-84"><a href="#cb9-84" aria-hidden="true" tabindex="-1"></a>    function <span class="fu">stringToBytes32</span><span class="op">(</span></span>
<span id="cb9-85"><a href="#cb9-85" aria-hidden="true" tabindex="-1"></a>        string memory source</span>
<span id="cb9-86"><a href="#cb9-86" aria-hidden="true" tabindex="-1"></a>    <span class="op">)</span> <span class="kw">private</span> pure <span class="fu">returns</span> <span class="op">(</span>bytes32 result<span class="op">)</span> <span class="op">{</span></span>
<span id="cb9-87"><a href="#cb9-87" aria-hidden="true" tabindex="-1"></a>        bytes memory tempEmptyStringTest <span class="op">=</span> <span class="fu">bytes</span><span class="op">(</span>source<span class="op">);</span></span>
<span id="cb9-88"><a href="#cb9-88" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>tempEmptyStringTest<span class="op">.</span><span class="fu">length</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb9-89"><a href="#cb9-89" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="bn">0x0</span><span class="op">;</span></span>
<span id="cb9-90"><a href="#cb9-90" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb9-91"><a href="#cb9-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-92"><a href="#cb9-92" aria-hidden="true" tabindex="-1"></a>        assembly <span class="op">{</span></span>
<span id="cb9-93"><a href="#cb9-93" aria-hidden="true" tabindex="-1"></a>            <span class="co">// solhint-disable-line no-inline-assembly</span></span>
<span id="cb9-94"><a href="#cb9-94" aria-hidden="true" tabindex="-1"></a>            result <span class="op">:=</span> <span class="fu">mload</span><span class="op">(</span><span class="fu">add</span><span class="op">(</span>source<span class="op">,</span> <span class="dv">32</span><span class="op">))</span></span>
<span id="cb9-95"><a href="#cb9-95" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb9-96"><a href="#cb9-96" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb9-97"><a href="#cb9-97" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>call the contract function ‚ÄòrequestEthereumPrice‚Äô set ‚Äô_oracle‚Äô
0x2174C8be4fb7dF9C7c42318643579c3E994CA343 &amp; ‚Äô_jobId‚Äô
‚Äò6e391cc297de4008a630edb1057c3f9c‚Äô variables</p>

          <!-- End README.md -->
      </div>
  </section>

  <!-- JavaScript -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/typed.js/2.0.10/typed.min.js"></script>
  <script src="./js/script.js"></script>
  <script src="./js/js.js"></script>

</html>
